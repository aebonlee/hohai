import{r as a,f as O,w as z,a as U,j as e,o as G,m as J,t as V}from"./index-CE2Wc_m1.js";import{u as Q,a as X,L as Z,S as ee}from"./LikeButton-DVnaNU1Y.js";import{a as te}from"./useViewCount-ClEcGSnf.js";let T=!1,R=!1;const I=[];function se(){return R&&window.YT?Promise.resolve():new Promise(t=>{if(I.push(t),T)return;T=!0;const l=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{R=!0,T=!1,l==null||l(),I.forEach(i=>i()),I.length=0},document.querySelector('script[src*="youtube.com/iframe_api"]')){window.YT&&window.YT.Player&&(R=!0,T=!1,I.forEach(i=>i()),I.length=0);return}const o=document.createElement("script");o.src="https://www.youtube.com/iframe_api",o.async=!0,document.head.appendChild(o)})}function ne({containerId:t,videoId:l,autoplay:o,enabled:i,onEnd:k,onPlay:N}){const u=a.useRef(null),d=a.useRef(k),r=a.useRef(N);d.current=k,r.current=N;const m=a.useCallback(()=>{var p;try{(p=u.current)==null||p.destroy()}catch{}u.current=null},[]);return a.useEffect(()=>{if(!i||!l){m();return}let p=!1;return se().then(()=>{p||!window.YT||(m(),!document.getElementById(t))||(u.current=new window.YT.Player(t,{videoId:l,playerVars:{autoplay:o?1:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1},events:{onStateChange:_=>{var w,b;_.data===0&&((w=d.current)==null||w.call(d)),_.data===1&&((b=r.current)==null||b.call(r))}}}))}),()=>{p=!0,m()}},[i,l,t,o,m]),{destroyPlayer:m}}const ae="_wrapper_1p6jo_1",ie="_favBtn_1p6jo_9",ce="_star_1p6jo_28",le="_favActive_1p6jo_43",oe="_moreBtn_1p6jo_54",re="_dropdown_1p6jo_75",ue="_dropdownHeader_1p6jo_88",de="_empty_1p6jo_98",me="_dropdownItem_1p6jo_104",pe="_included_1p6jo_123",_e="_itemCheck_1p6jo_127",ye="_itemName_1p6jo_133",he="_itemCount_1p6jo_140",fe="_createBtn_1p6jo_146",we="_createForm_1p6jo_165",je="_createInput_1p6jo_172",xe="_createConfirm_1p6jo_188",c={wrapper:ae,favBtn:ie,star:ce,favActive:le,moreBtn:oe,dropdown:re,dropdownHeader:ue,empty:de,dropdownItem:me,included:pe,itemCheck:_e,itemName:ye,itemCount:he,createBtn:fe,createForm:we,createInput:je,createConfirm:xe},q="즐겨찾기";function ve({songId:t}){const{isLoggedIn:l,user:o}=O(),{playlists:i,createPlaylist:k,addSongToPlaylist:N,removeSongFromPlaylist:u}=z(),d=U(),[r,m]=a.useState(!1),[p,f]=a.useState(!1),[_,w]=a.useState(""),[b,P]=a.useState(!1),g=a.useRef(null),j=i.find(n=>n.name===q),y=j?j.song_ids.includes(t):!1;a.useEffect(()=>{if(!r)return;const n=v=>{g.current&&!g.current.contains(v.target)&&(m(!1),f(!1))};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[r]);const S=async n=>{if(n.stopPropagation(),!l){d("/login");return}if(!b){P(!0);try{j?y?await u(j.id,t):await N(j.id,t):await k({user_id:o.id,name:q,song_ids:[t]})}finally{P(!1)}}},A=n=>{if(n.stopPropagation(),!l){d("/login");return}m(!r),f(!1)},L=async n=>{await N(n,t)},C=async n=>{await u(n,t)},x=async()=>{!_.trim()||!o||(await k({user_id:o.id,name:_.trim(),song_ids:[t]}),w(""),f(!1))},B=n=>{n.key==="Enter"&&x(),n.key==="Escape"&&f(!1)};return e.jsxs("div",{className:c.wrapper,ref:g,children:[e.jsxs("button",{className:`${c.favBtn} ${y?c.favActive:""}`,onClick:S,disabled:b,"aria-label":y?"즐겨찾기에서 제거":"즐겨찾기에 추가",title:y?"즐겨찾기에서 이 곡을 제거합니다":"이 곡을 즐겨찾기에 추가합니다",children:[e.jsx("span",{className:c.star,children:y?"★":"☆"}),"즐겨찾기"]}),e.jsx("button",{className:c.moreBtn,onClick:A,"aria-label":"다른 재생목록에 추가",title:"다른 재생목록을 선택하여 곡을 추가합니다",children:"▾"}),r&&e.jsxs("div",{className:c.dropdown,children:[e.jsx("div",{className:c.dropdownHeader,children:"재생목록에 추가"}),i.length===0&&!p&&e.jsx("div",{className:c.empty,children:"재생목록이 없습니다"}),i.map(n=>{const v=n.song_ids.includes(t);return e.jsxs("button",{className:`${c.dropdownItem} ${v?c.included:""}`,onClick:()=>v?C(n.id):L(n.id),children:[e.jsx("span",{className:c.itemCheck,children:v?"✓":""}),e.jsx("span",{className:c.itemName,children:n.name}),e.jsxs("span",{className:c.itemCount,children:[n.song_ids.length,"곡"]})]},n.id)}),p?e.jsxs("div",{className:c.createForm,children:[e.jsx("input",{className:c.createInput,type:"text",value:_,onChange:n=>w(n.target.value),onKeyDown:B,placeholder:"재생목록 이름",autoFocus:!0,maxLength:50}),e.jsx("button",{className:c.createConfirm,onClick:x,disabled:!_.trim(),children:"확인"})]}):e.jsx("button",{className:c.createBtn,onClick:()=>f(!0),children:"+ 새 재생목록 만들기"})]})]})}function ke(t){return t.split(`
`).filter(l=>!/^\s*\[.*\]\s*$/.test(l)).join(`
`).replace(/\n{3,}/g,`

`).trim()}const Ne="_card_pwkl9_1",be="_thumbnail_pwkl9_13",ge="_thumbnailImg_pwkl9_22",Ce="_playBtn_pwkl9_33",Pe="_sourceBadge_pwkl9_64",Be="_ytContainer_pwkl9_84",Ie="_sunoPlaceholder_pwkl9_90",Se="_sunoLabel_pwkl9_109",Le="_sunoPlayIcon_pwkl9_115",Te="_sunoIframe_pwkl9_146",Ae="_sunoSection_pwkl9_154",Ee="_sunoBtn_pwkl9_164",Re="_playlistNav_pwkl9_185",Fe="_navBtn_pwkl9_195",Ye="_navPosition_pwkl9_215",$e="_info_pwkl9_223",Ve="_statsRow_pwkl9_227",qe="_counts_pwkl9_236",Oe="_countItem_pwkl9_242",He="_actions_pwkl9_256",De="_title_pwkl9_262",Me="_description_pwkl9_270",We="_tags_pwkl9_281",Ke="_tag_pwkl9_281",ze="_lyricsActions_pwkl9_297",Ue="_lyricsToggle_pwkl9_305",Ge="_lyricsPlayerBtn_pwkl9_322",Je="_lyrics_pwkl9_297",s={card:Ne,thumbnail:be,thumbnailImg:ge,playBtn:Ce,sourceBadge:Pe,ytContainer:Be,sunoPlaceholder:Ie,sunoLabel:Se,sunoPlayIcon:Le,sunoIframe:Te,sunoSection:Ae,sunoBtn:Ee,playlistNav:Re,navBtn:Fe,navPosition:Ye,info:$e,statsRow:Ve,counts:qe,countItem:Oe,actions:He,title:De,description:Me,tags:We,tag:Ke,lyricsActions:ze,lyricsToggle:Ue,lyricsPlayerBtn:Ge,lyrics:Je};function st({song:t,index:l=0,contextPlaylist:o}){const{currentId:i,play:k,onSongEnd:N,playlist:u,currentIndex:d,hasNext:r,hasPrev:m,next:p,prev:f,setPlaylist:_,autoPlayIntent:w,openLyricsPlayer:b}=G(),[P,g]=a.useState(!1),[j,y]=a.useState(!1),[S,A]=a.useState(!1),L=a.useRef(null),C=!!t.youtube_id,x=!!t.suno_url,{user:B}=O(),{count:n}=Q("song",t.id,B==null?void 0:B.id),v=X(t.id),F=te("hohai_songs"),H=!!t.lyrics,D=t.tags&&t.tags.length>0,M=u!==null&&i===t.id&&d>=0,Y=`yt-${a.useId().replace(/:/g,"")}`;a.useEffect(()=>{i&&i!==t.id&&(g(!1),y(!1))},[i,t.id]),a.useEffect(()=>{i===t.id&&w&&(C?g(!0):x&&y(!0),requestAnimationFrame(()=>{var h;(h=L.current)==null||h.scrollIntoView({behavior:"smooth",block:"center"})}))},[i,t.id,w,C,x]),ne({containerId:Y,videoId:t.youtube_id||null,autoplay:!0,enabled:P&&C,onEnd:()=>{N()}});const E=h=>{o&&o.length>0&&_(o),k(h)},W=()=>{F(t.id),E(t.id),g(!0)},$=()=>{F(t.id),E(t.id),y(!0)},K=()=>{E(t.id),b()};return e.jsxs(J.article,{ref:L,className:s.card,initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-40px"},transition:{duration:.5,delay:l*.1},children:[e.jsx("div",{className:s.thumbnail,children:C?P?e.jsx("div",{id:Y,className:s.ytContainer}):e.jsxs(e.Fragment,{children:[e.jsx("img",{className:s.thumbnailImg,src:`https://img.youtube.com/vi/${t.youtube_id}/hqdefault.jpg`,alt:t.title,loading:"lazy"}),e.jsx("button",{className:s.playBtn,onClick:W,"aria-label":`${t.title} 재생`,title:"클릭하면 노래가 재생됩니다"}),x&&e.jsx("span",{className:s.sourceBadge,children:"YouTube"})]}):x?j?e.jsx("iframe",{className:s.sunoIframe,src:V(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("div",{className:s.sunoPlaceholder,onClick:$,title:"클릭하면 노래가 재생됩니다",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),e.jsx("span",{className:s.sunoLabel,children:"음원 재생"}),e.jsx("div",{className:s.sunoPlayIcon})]}):null}),C&&x&&e.jsx("div",{className:s.sunoSection,children:j?e.jsx("iframe",{className:s.sunoIframe,src:V(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("button",{className:s.sunoBtn,onClick:$,title:"음원 버전을 재생합니다",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),"음원 듣기"]})}),M&&u&&e.jsxs("div",{className:s.playlistNav,children:[e.jsx("button",{className:s.navBtn,onClick:f,disabled:!m,"aria-label":"이전 곡",title:"이전 곡으로 이동합니다",children:"⏮"}),e.jsxs("span",{className:s.navPosition,children:[d+1," / ",u.length]}),e.jsx("button",{className:s.navBtn,onClick:p,disabled:!r,"aria-label":"다음 곡",title:"다음 곡으로 이동합니다",children:"⏭"})]}),e.jsxs("div",{className:s.info,children:[e.jsx("h3",{className:s.title,children:t.title}),e.jsxs("div",{className:s.statsRow,children:[e.jsxs("div",{className:s.counts,children:[e.jsxs("span",{className:s.countItem,children:["▶ ",t.view_count??0]}),n>0&&e.jsxs("span",{className:s.countItem,children:["♥ ",n]}),v>0&&e.jsxs("span",{className:s.countItem,children:["★ ",v]})]}),e.jsxs("div",{className:s.actions,children:[e.jsx(ve,{songId:t.id}),e.jsx(Z,{targetType:"song",targetId:t.id}),e.jsx(ee,{title:t.title,text:t.description||t.title})]})]}),t.description&&e.jsx("p",{className:s.description,children:t.description}),D&&e.jsx("div",{className:s.tags,children:t.tags.map(h=>e.jsxs("span",{className:s.tag,children:["#",h]},h))}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.lyricsActions,children:[e.jsx("button",{className:s.lyricsToggle,onClick:()=>A(h=>!h),title:"가사를 펼치거나 접습니다",children:S?"가사 접기 ▲":"가사 보기 ▼"}),e.jsx("button",{className:s.lyricsPlayerBtn,onClick:K,title:"전체 화면으로 가사를 보면서 들을 수 있습니다",children:"가사 플레이어"})]}),S&&e.jsx("div",{className:s.lyrics,children:ke(t.lyrics)})]})]})]})}export{ve as A,st as S,ke as c,ne as u};
