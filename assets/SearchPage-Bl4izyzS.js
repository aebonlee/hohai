import{r as i,s as g,u as _,j as e,P as f,H as j,c as v}from"./index-Dq0PCZmx.js";import{S as I}from"./SongCard-pcT-608N.js";import"./LikeButton-CZTR27Kt.js";import"./useViewCount-DjxGBIFS.js";function y(l){const[p,u]=i.useState({poems:[],songs:[]}),[c,h]=i.useState(!1),r=i.useRef(0),o=i.useCallback(async m=>{const d=m.trim();if(!d){u({poems:[],songs:[]}),h(!1);return}const a=++r.current;h(!0);const s=`%${d}%`,[n,x]=await Promise.all([g.from("hohai_poems").select("*").eq("is_published",!0).or(`title.ilike.${s},content.ilike.${s}`).order("created_at",{ascending:!1}).limit(20),g.from("hohai_songs").select("*").eq("is_published",!0).or(`title.ilike.${s},lyrics.ilike.${s}`).order("created_at",{ascending:!1}).limit(20)]);a===r.current&&(u({poems:n.data||[],songs:x.data||[]}),h(!1))},[]);return i.useEffect(()=>{const m=setTimeout(()=>o(l),300);return()=>clearTimeout(m)},[l,o]),{results:p,loading:c}}const N="_page_9rw6v_1",w="_searchHeader_9rw6v_11",k="_searchInput_9rw6v_19",S="_searchInputWrapper_9rw6v_57",P="_searchIcon_9rw6v_69",T="_resultInfo_9rw6v_87",C="_sectionTitle_9rw6v_101",L="_poemGrid_9rw6v_121",q="_songList_9rw6v_135",H="_empty_9rw6v_149",t={page:N,searchHeader:w,searchInput:k,searchInputWrapper:S,searchIcon:P,resultInfo:T,sectionTitle:C,poemGrid:L,songList:q,empty:H};function E(){const[l,p]=_(),u=l.get("q")||"",[c,h]=i.useState(u),{results:r,loading:o}=y(c);i.useEffect(()=>{const s=l.get("q")||"";s!==c&&h(s)},[l]);const m=s=>{const n=s.target.value;h(n),n.trim()?p({q:n},{replace:!0}):p({},{replace:!0})},d=r.poems.length+r.songs.length,a=c.trim().length>0;return e.jsxs(f,{children:[e.jsx(j,{children:e.jsx("title",{children:a?`"${c}" 검색 결과 — 好海`:"검색 — 好海"})}),e.jsx("div",{className:t.page,children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:t.searchHeader,children:[e.jsx("h1",{className:"section-title",style:{textAlign:"center",marginBottom:"24px"},children:"검색"}),e.jsxs("div",{className:t.searchInputWrapper,children:[e.jsxs("svg",{className:t.searchIcon,width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{className:t.searchInput,type:"text",value:c,onChange:m,placeholder:"시 제목, 내용, 노래 가사로 검색...",autoFocus:!0})]})]}),o&&a&&e.jsx("p",{className:t.resultInfo,children:"검색 중..."}),!o&&a&&e.jsxs("p",{className:t.resultInfo,children:['"',c,'" 검색 결과 ',d,"건"]}),!o&&a&&r.poems.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:t.sectionTitle,children:["시 (",r.poems.length,")"]}),e.jsx("div",{className:t.poemGrid,children:r.poems.map((s,n)=>e.jsx(v,{poem:s,index:n},s.id))})]}),!o&&a&&r.songs.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:t.sectionTitle,children:["노래 (",r.songs.length,")"]}),e.jsx("div",{className:t.songList,children:r.songs.map((s,n)=>e.jsx(I,{song:s,index:n},s.id))})]}),!o&&a&&d===0&&e.jsx("p",{className:t.empty,children:"검색 결과가 없습니다. 다른 키워드로 검색해보세요."}),!a&&e.jsx("p",{className:t.empty,children:"시 제목, 내용, 노래 가사를 검색할 수 있습니다."})]})})]})}export{E as default};
