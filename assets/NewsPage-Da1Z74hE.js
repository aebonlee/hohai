import{f as C,r as c,j as e,P as v,H as B,L as h,m as L}from"./index-Dq0PCZmx.js";import{u as A}from"./useNews-L1aKqX8w.js";import{f as T}from"./formatDate-teZXCzp_.js";const H="_page_1pg5j_1",S="_backLink_1pg5j_9",I="_header_1pg5j_35",D="_subtitle_1pg5j_45",P="_writeArea_1pg5j_59",R="_writeBtn_1pg5j_69",V="_form_1pg5j_109",F="_formInput_1pg5j_129",q="_formTextarea_1pg5j_159",E="_formActions_1pg5j_193",$="_cancelBtn_1pg5j_205",z="_submitBtn_1pg5j_235",G="_newsList_1pg5j_277",J="_newsCard_1pg5j_293",K="_newsHeader_1pg5j_317",M="_newsTitle_1pg5j_333",O="_newsHeaderRight_1pg5j_349",Q="_newsViewCount_1pg5j_363",U="_newsDate_1pg5j_373",W="_newsContent_1pg5j_383",X="_newsAuthor_1pg5j_401",Y="_deleteBtn_1pg5j_413",Z="_loginPrompt_1pg5j_443",ee="_loginLink_1pg5j_473",se="_feedback_1pg5j_505",te="_success_1pg5j_523",ne="_error_1pg5j_535",ae="_empty_1pg5j_547",s={page:H,backLink:S,header:I,subtitle:D,writeArea:P,writeBtn:R,form:V,formInput:F,formTextarea:q,formActions:E,cancelBtn:$,submitBtn:z,newsList:G,newsCard:J,newsHeader:K,newsTitle:M,newsHeaderRight:O,newsViewCount:Q,newsDate:U,newsContent:W,newsAuthor:X,deleteBtn:Y,loginPrompt:Z,loginLink:ee,feedback:se,success:te,error:ne,empty:ae};function oe(){const{items:j,loading:x,createItem:f,deleteItem:N}=A(),{isLoggedIn:r,profile:o,user:n}=C(),[b,l]=c.useState(!1),[m,d]=c.useState(""),[_,p]=c.useState(""),[g,w]=c.useState(!1),[u,a]=c.useState(null),y=async t=>{if(t.preventDefault(),!m.trim()||!_.trim()||!r)return;w(!0),a(null);const{error:i}=await f({title:m.trim(),content:_.trim(),author_name:(o==null?void 0:o.display_name)||(n==null?void 0:n.email)||"익명",user_id:(n==null?void 0:n.id)||null});i?a({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(a({type:"success",message:"소식이 등록되었습니다."}),d(""),p(""),l(!1)),w(!1),setTimeout(()=>a(null),3e3)},k=async t=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:i}=await N(t);a(i?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>a(null),3e3)};return e.jsxs(v,{children:[e.jsxs(B,{children:[e.jsx("title",{children:"소식통 — 好海"}),e.jsx("meta",{name:"description",content:"好海 소식통 — 소식과 이야기를 전해주세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(h,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"소식통"}),e.jsx("p",{className:s.subtitle,children:"소식과 이야기를 전해주세요"})]}),u&&e.jsx("div",{className:`${s.feedback} ${s[u.type]}`,children:u.message}),e.jsx("div",{className:s.writeArea,children:r?b?e.jsxs("form",{className:s.form,onSubmit:y,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>d(t.target.value),required:!0}),e.jsx("textarea",{className:s.formTextarea,placeholder:"내용을 작성해주세요...",value:_,onChange:t=>p(t.target.value),required:!0,rows:5}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>{l(!1),d(""),p("")},children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:g,children:g?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>l(!0),children:"소식 작성하기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 소식을 전해주세요"}),e.jsx(h,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),x?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):j.length>0?e.jsx("div",{className:s.newsList,children:j.map((t,i)=>e.jsxs(L.article,{className:s.newsCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:i*.05},children:[e.jsxs("div",{className:s.newsHeader,children:[e.jsx("h3",{className:s.newsTitle,children:t.title}),e.jsxs("div",{className:s.newsHeaderRight,children:[e.jsxs("span",{className:s.newsViewCount,children:["조회 ",t.view_count??0]}),e.jsx("span",{className:s.newsDate,children:T(t.created_at)}),r&&(n==null?void 0:n.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>k(t.id),children:"삭제"})]})]}),e.jsx("p",{className:s.newsContent,children:t.content}),e.jsx("span",{className:s.newsAuthor,children:t.author_name})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 소식이 없습니다. 첫 번째 소식을 전해주세요!"})]})})]})}export{oe as default};
