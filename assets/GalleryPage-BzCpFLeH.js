import{f as P,r as n,j as e,P as G,H as V,L as D,m as W}from"./index-CE2Wc_m1.js";import{u as E,a as $}from"./useGallery-BP1-zSWb.js";import{a as H}from"./useViewCount-ClEcGSnf.js";import{f as U}from"./formatDate-teZXCzp_.js";const q="_page_1p0nt_1",O="_backLink_1p0nt_5",X="_header_1p0nt_18",Z="_subtitle_1p0nt_23",J="_writeArea_1p0nt_30",K="_writeBtn_1p0nt_35",Q="_form_1p0nt_55",Y="_formInput_1p0nt_65",ee="_dropzone_1p0nt_80",te="_dragging_1p0nt_95",se="_dropzoneText_1p0nt_100",ae="_previewImg_1p0nt_111",le="_formTextarea_1p0nt_118",ne="_formActions_1p0nt_135",re="_cancelBtn_1p0nt_141",ie="_submitBtn_1p0nt_156",oe="_galleryGrid_1p0nt_177",ce="_galleryCard_1p0nt_185",ge="_galleryImageWrap_1p0nt_197",me="_galleryImage_1p0nt_197",pe="_galleryInfo_1p0nt_214",de="_galleryTitle_1p0nt_218",_e="_galleryDesc_1p0nt_226",ue="_galleryMeta_1p0nt_234",ye="_galleryAuthor_1p0nt_242",he="_galleryMetaRight_1p0nt_246",fe="_galleryViewCount_1p0nt_252",xe="_galleryDate_1p0nt_256",je="_deleteBtn_1p0nt_260",Ne="_loginPrompt_1p0nt_276",we="_loginLink_1p0nt_291",be="_feedback_1p0nt_307",ve="_success_1p0nt_316",Ie="_error_1p0nt_322",ke="_empty_1p0nt_328",s={page:q,backLink:O,header:X,subtitle:Z,writeArea:J,writeBtn:K,form:Q,formInput:Y,dropzone:ee,dragging:te,dropzoneText:se,previewImg:ae,formTextarea:le,formActions:ne,cancelBtn:re,submitBtn:ie,galleryGrid:oe,galleryCard:ce,galleryImageWrap:ge,galleryImage:me,galleryInfo:pe,galleryTitle:de,galleryDesc:_e,galleryMeta:ue,galleryAuthor:ye,galleryMetaRight:he,galleryViewCount:fe,galleryDate:xe,deleteBtn:je,loginPrompt:Ne,loginLink:we,feedback:be,success:ve,error:Ie,empty:ke},De=5*1024*1024;function Le(){const{items:x,loading:T,createItem:B,deleteItem:C}=E(),A=H("hohai_gallery"),{isLoggedIn:o,profile:c,user:i}=P(),[L,g]=n.useState(!1),[m,p]=n.useState(""),[j,d]=n.useState(""),[_,u]=n.useState(null),[N,y]=n.useState(null),[S,h]=n.useState(!1),[w,b]=n.useState(!1),[f,l]=n.useState(null),v=n.useRef(null),I=t=>{if(t.size>De){l({type:"error",message:"파일 크기는 5MB 이하만 가능합니다."}),setTimeout(()=>l(null),3e3);return}if(!t.type.startsWith("image/")){l({type:"error",message:"이미지 파일만 업로드 가능합니다."}),setTimeout(()=>l(null),3e3);return}u(t);const a=new FileReader;a.onload=r=>{var k;return y((k=r.target)==null?void 0:k.result)},a.readAsDataURL(t)},M=t=>{t.preventDefault(),h(!1);const a=t.dataTransfer.files[0];a&&I(a)},z=async t=>{if(t.preventDefault(),!(!m.trim()||!_||!o||!i)){b(!0),l(null);try{const a=await $(_,i.id),{error:r}=await B({title:m.trim(),image_url:a,description:j.trim(),author_name:(c==null?void 0:c.display_name)||i.email||"익명",user_id:i.id});r?l({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(l({type:"success",message:"갤러리에 등록되었습니다."}),p(""),d(""),u(null),y(null),g(!1))}catch{l({type:"error",message:"이미지 업로드에 실패했습니다."})}b(!1),setTimeout(()=>l(null),3e3)}},R=async(t,a)=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:r}=await C(t,a);l(r?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>l(null),3e3)},F=()=>{g(!1),p(""),d(""),u(null),y(null)};return e.jsxs(G,{children:[e.jsxs(V,{children:[e.jsx("title",{children:"갤러리 — 好海"}),e.jsx("meta",{name:"description",content:"好海 갤러리 — 이미지와 함께 추억을 공유하세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(D,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"갤러리"}),e.jsx("p",{className:s.subtitle,children:"이미지와 함께 추억을 공유하세요"})]}),f&&e.jsx("div",{className:`${s.feedback} ${s[f.type]}`,children:f.message}),e.jsx("div",{className:s.writeArea,children:o?L?e.jsxs("form",{className:s.form,onSubmit:z,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>p(t.target.value),required:!0}),e.jsxs("div",{className:`${s.dropzone} ${S?s.dragging:""}`,onDragOver:t=>{t.preventDefault(),h(!0)},onDragLeave:()=>h(!1),onDrop:M,onClick:()=>{var t;return(t=v.current)==null?void 0:t.click()},children:[N?e.jsx("img",{src:N,alt:"미리보기",className:s.previewImg}):e.jsxs("p",{className:s.dropzoneText,children:["이미지를 드래그하거나 클릭하여 업로드",e.jsx("br",{}),e.jsx("small",{children:"(최대 5MB)"})]}),e.jsx("input",{ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var r;const a=(r=t.target.files)==null?void 0:r[0];a&&I(a)}})]}),e.jsx("textarea",{className:s.formTextarea,placeholder:"설명 (선택사항)",value:j,onChange:t=>d(t.target.value),rows:3}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:F,children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:w||!_,children:w?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>g(!0),children:"사진 올리기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 갤러리에 사진을 올려주세요"}),e.jsx(D,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),T?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):x.length>0?e.jsx("div",{className:s.galleryGrid,children:x.map((t,a)=>e.jsxs(W.article,{className:s.galleryCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:a*.05},children:[e.jsx("div",{className:s.galleryImageWrap,onClick:()=>A(t.id),children:e.jsx("img",{src:t.image_url,alt:t.title,className:s.galleryImage})}),e.jsxs("div",{className:s.galleryInfo,children:[e.jsx("h3",{className:s.galleryTitle,children:t.title}),t.description&&e.jsx("p",{className:s.galleryDesc,children:t.description}),e.jsxs("div",{className:s.galleryMeta,children:[e.jsx("span",{className:s.galleryAuthor,children:t.author_name}),e.jsxs("span",{className:s.galleryMetaRight,children:[e.jsxs("span",{className:s.galleryViewCount,children:["조회 ",t.view_count??0]}),e.jsx("span",{className:s.galleryDate,children:U(t.created_at)})]})]}),o&&(i==null?void 0:i.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>R(t.id,t.image_url),children:"삭제"})]})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 갤러리에 사진이 없습니다. 첫 번째 사진을 올려주세요!"})]})})]})}export{Le as default};
