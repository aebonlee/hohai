import{o as w,r as o,f as R,q as H,j as t,A as M,m as r,l as W,t as z}from"./index-CNhTrOr2.js";import{r as D,L as q}from"./LyricsEffects-BhO46jz4.js";import{u as F,A as $,c as K}from"./SongCard-EIH5Jbc3.js";import{u as Y,a as G,L as U,S as J}from"./LikeButton-zzio4th6.js";const Q="_overlay_1ftzd_21",V="_closeBtn_1ftzd_59",X="_content_1ftzd_115",Z="_playerPanel_1ftzd_141",O="_playerWrapper_1ftzd_157",tt="_secondaryPlayer_1ftzd_191",et="_playlistNav_1ftzd_221",st="_navBtn_1ftzd_243",at="_navPosition_1ftzd_287",nt="_songMeta_1ftzd_305",ot="_songTitle_1ftzd_317",it="_songCounts_1ftzd_333",lt="_songCountHeart_1ftzd_345",ct="_songCountStar_1ftzd_357",rt="_songActions_1ftzd_369",dt="_songTags_1ftzd_389",ut="_songTag_1ftzd_389",yt="_lyricsPanel_1ftzd_423",mt="_lyricsHeader_1ftzd_447",_t="_lyricsBody_1ftzd_471",ft="_noLyrics_1ftzd_531",e={overlay:Q,closeBtn:V,content:X,playerPanel:Z,playerWrapper:O,secondaryPlayer:tt,playlistNav:et,navBtn:st,navPosition:at,songMeta:nt,songTitle:ot,songCounts:it,songCountHeart:lt,songCountStar:ct,songActions:rt,songTags:dt,songTag:ut,lyricsPanel:yt,lyricsHeader:mt,lyricsBody:_t,noLyrics:ft};function jt({song:s,isOpen:i,onClose:l}){const{onSongEnd:C,playlist:d,currentIndex:v,hasNext:T,hasPrev:E,next:B,prev:L}=w(),h=o.useRef(null),u=o.useRef(null),y=o.useRef(null),{user:m}=R(),{count:_}=Y("song",s.id,m==null?void 0:m.id),f=G(s.id),p=!!s.youtube_id,g=!!s.suno_url,k=!!s.lyrics,A=s.tags&&s.tags.length>0,S=d!==null&&v>=0,j=H(s.tags),c=W[j],b=`lp-yt-${o.useId().replace(/:/g,"")}`;F({containerId:b,videoId:s.youtube_id||null,autoplay:!1,enabled:i&&p,onEnd:()=>{C()}});const x=o.useCallback(a=>{if(a.key==="Escape"){l();return}if(a.key==="Tab"&&y.current){const n=y.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), iframe');if(n.length===0)return;const N=n[0],P=n[n.length-1];a.shiftKey?document.activeElement===N&&(a.preventDefault(),P.focus()):document.activeElement===P&&(a.preventDefault(),N.focus())}},[l]);o.useEffect(()=>{if(!i)return;u.current=document.activeElement;const a=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",document.body.style.paddingRight=`${a}px`,requestAnimationFrame(()=>{var n;return(n=h.current)==null?void 0:n.focus()}),document.addEventListener("keydown",x),()=>{document.body.style.overflow="",document.body.style.paddingRight="",document.removeEventListener("keydown",x),u.current instanceof HTMLElement&&u.current.focus()}},[i,x]);const I=a=>{a.target===a.currentTarget&&l()};return D.createPortal(t.jsx(M,{children:i&&t.jsxs(r.div,{ref:y,className:e.overlay,role:"dialog","aria-modal":"true","aria-label":`${s.title} — 가사 플레이어`,onClick:I,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},style:{"--mood-c1":c.c1,"--mood-c2":c.c2,"--mood-c3":c.c3,"--mood-c4":c.c4},children:[t.jsx(q,{mood:j,isActive:i}),t.jsx(r.button,{ref:h,className:e.closeBtn,onClick:l,"aria-label":"닫기",title:"가사 플레이어를 닫습니다 (ESC키로도 닫을 수 있습니다)",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3,delay:.3},children:"✕"}),t.jsxs("div",{className:e.content,children:[t.jsxs(r.div,{className:e.playerPanel,initial:{opacity:0,x:-40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.5,delay:.15},children:[t.jsx("div",{className:e.playerWrapper,children:p?t.jsx("div",{id:b,style:{width:"100%",height:"100%"}}):g?t.jsx("iframe",{src:z(s.suno_url),title:s.title,allow:"autoplay"}):null}),p&&g&&t.jsx("div",{className:e.secondaryPlayer,children:t.jsx("iframe",{src:z(s.suno_url),title:s.title,allow:"autoplay"})}),S&&d&&t.jsxs("div",{className:e.playlistNav,children:[t.jsx("button",{className:e.navBtn,onClick:L,disabled:!E,"aria-label":"이전 곡",title:"이전 곡",children:"⏮ 이전"}),t.jsxs("span",{className:e.navPosition,children:[v+1," / ",d.length]}),t.jsx("button",{className:e.navBtn,onClick:B,disabled:!T,"aria-label":"다음 곡",title:"다음 곡",children:"다음 ⏭"})]}),t.jsxs("div",{className:e.songMeta,children:[t.jsx("h2",{className:e.songTitle,children:s.title}),(_>0||f>0)&&t.jsxs("div",{className:e.songCounts,children:[_>0&&t.jsxs("span",{className:e.songCountHeart,children:["♥ ",_]}),f>0&&t.jsxs("span",{className:e.songCountStar,children:["★ ",f]})]}),t.jsxs("div",{className:e.songActions,children:[t.jsx(U,{targetType:"song",targetId:s.id}),t.jsx($,{songId:s.id}),t.jsx(J,{title:s.title,text:s.title})]}),A&&t.jsx("div",{className:e.songTags,children:s.tags.map(a=>t.jsxs("span",{className:e.songTag,children:["#",a]},a))})]})]}),t.jsxs(r.div,{className:e.lyricsPanel,initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:40},transition:{duration:.5,delay:.25},children:[t.jsx("div",{className:e.lyricsHeader,children:"가사"}),k?t.jsx("div",{className:e.lyricsBody,children:K(s.lyrics)}):t.jsx("div",{className:e.noLyrics,children:"가사가 없습니다"})]})]})]})}),document.body)}export{jt as L};
