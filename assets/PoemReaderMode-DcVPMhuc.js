import{r as o,j as n,A as D,m as L,i as I,l as S,h as $}from"./index-Dq0PCZmx.js";import{r as B,L as M}from"./LyricsEffects-BbYDx1Iw.js";const P="_overlay_1kdgx_35",z="_header_1kdgx_67",H="_closeBtn_1kdgx_103",G="_seriesName_1kdgx_151",W="_position_1kdgx_173",q="_scrollContainer_1kdgx_191",F="_slide_1kdgx_223",K="_slideLong_1kdgx_255",V="_slideInner_1kdgx_265",J="_poemCategory_1kdgx_277",Q="_poemTitle_1kdgx_295",U="_poemDate_1kdgx_313",X="_poemContent_1kdgx_327",Y="_stanza_1kdgx_343",Z="_poemTags_1kdgx_361",O="_poemTag_1kdgx_361",ee="_hint_1kdgx_399",te="_hintArrow_1kdgx_443",ne="_dots_1kdgx_455",se="_dot_1kdgx_455",oe="_dotActive_1kdgx_501",s={overlay:P,header:z,closeBtn:H,seriesName:G,position:W,scrollContainer:q,slide:F,slideLong:K,slideInner:V,poemCategory:J,poemTitle:Q,poemDate:U,poemContent:X,stanza:Y,poemTags:Z,poemTag:O,hint:ee,hintArrow:te,dots:ne,dot:se,dotActive:oe};function re(c){return $[c]?c:"default"}function ie({poems:c,initialIndex:d,seriesName:x,isOpen:r,onClose:i}){const[u,N]=o.useState(d),[j,w]=o.useState(!0),m=o.useRef(null),b=o.useRef(null),v=o.useRef(null),p=o.useRef(null),f=o.useRef([]),y=o.useRef(null),_=c[u]?re(c[u].category):"default",g=S[_],E=I[_],k=o.useCallback(e=>{if(e.key==="Escape"){i();return}if(e.key==="Tab"&&p.current){const t=p.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(t.length===0)return;const a=t[0],h=t[t.length-1];e.shiftKey?document.activeElement===a&&(e.preventDefault(),h.focus()):document.activeElement===h&&(e.preventDefault(),a.focus())}},[i]);o.useEffect(()=>{if(!r)return;v.current=document.activeElement;const e=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",document.body.style.paddingRight=`${e}px`,requestAnimationFrame(()=>{var t;return(t=b.current)==null?void 0:t.focus()}),document.addEventListener("keydown",k),()=>{document.body.style.overflow="",document.body.style.paddingRight="",document.removeEventListener("keydown",k),v.current instanceof HTMLElement&&v.current.focus()}},[r,k]),o.useEffect(()=>{if(!r)return;const e=()=>i();return window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[r,i]),o.useEffect(()=>{if(!r||!m.current)return;N(d);const e=f.current[d];e&&e.scrollIntoView({behavior:"instant"})},[r,d]),o.useEffect(()=>{if(!(!r||!m.current))return y.current=new IntersectionObserver(e=>{for(const t of e)if(t.isIntersecting&&t.intersectionRatio>=.5){const a=Number(t.target.getAttribute("data-index"));isNaN(a)||N(a)}},{root:m.current,threshold:.5}),f.current.forEach(e=>{e&&y.current.observe(e)}),()=>{var e;(e=y.current)==null||e.disconnect()}},[r,c.length]),o.useEffect(()=>{if(!r)return;w(!0);const e=setTimeout(()=>w(!1),2600);return()=>clearTimeout(e)},[r]);const T=e=>{const t=f.current[e];t&&t.scrollIntoView({behavior:"smooth"})},R=e=>{e.target===e.currentTarget&&i()},A=e=>e.content.split(`
`).length>20;return B.createPortal(n.jsx(D,{children:r&&n.jsxs(L.div,{ref:p,className:s.overlay,role:"dialog","aria-modal":"true","aria-label":`${x||"시집"} — 읽기 모드`,onClick:R,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},style:{"--mood-c1":g.c1,"--mood-c2":g.c2,"--mood-c3":g.c3,"--mood-c4":g.c4,"--mood-accent":E},children:[n.jsx(M,{mood:_,isActive:r},_),n.jsxs("div",{className:s.header,children:[n.jsx("button",{ref:b,className:s.closeBtn,onClick:i,"aria-label":"닫기",children:"✕"}),x&&n.jsx("span",{className:s.seriesName,children:x}),n.jsxs("span",{className:s.position,children:[u+1,"/",c.length]})]}),c.length<=30&&n.jsx("div",{className:s.dots,children:c.map((e,t)=>n.jsx("button",{className:`${s.dot} ${t===u?s.dotActive:""}`,onClick:()=>T(t),"aria-label":`${t+1}번째 시로 이동`},t))}),n.jsx("div",{ref:m,className:s.scrollContainer,children:c.map((e,t)=>{const a=e.content.split(/\n\s*\n/).filter(Boolean),h=A(e);return n.jsx("div",{ref:l=>{f.current[t]=l},"data-index":t,className:`${s.slide} ${h?s.slideLong:""}`,children:n.jsxs("div",{className:s.slideInner,children:[n.jsx("div",{className:s.poemCategory,children:e.category}),n.jsx("h2",{className:s.poemTitle,children:e.title}),e.written_date&&n.jsx("p",{className:s.poemDate,children:e.written_date}),n.jsx("div",{className:s.poemContent,children:a.map((l,C)=>n.jsx("div",{className:s.stanza,children:l},C))}),e.tags&&e.tags.length>0&&n.jsx("div",{className:s.poemTags,children:e.tags.map(l=>n.jsxs("span",{className:s.poemTag,children:["#",l]},l))})]})},e.id)})}),j&&n.jsxs("div",{className:s.hint,children:[n.jsx("span",{className:s.hintArrow,children:"↕"}),"위아래로 스와이프하여 넘기기"]})]})}),document.body)}export{ie as P};
