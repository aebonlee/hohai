import{f as P,r,j as e,P as G,H as V,L as D,m as W}from"./index-Dq0PCZmx.js";import{u as E,a as $}from"./useGallery-gS5ymcWs.js";import{a as H}from"./useViewCount-DjxGBIFS.js";import{f as U}from"./formatDate-teZXCzp_.js";const q="_page_wc0e4_1",O="_backLink_wc0e4_9",X="_header_wc0e4_35",Z="_subtitle_wc0e4_45",J="_writeArea_wc0e4_59",K="_writeBtn_wc0e4_69",Q="_form_wc0e4_109",Y="_formInput_wc0e4_129",ee="_dropzone_wc0e4_159",se="_dragging_wc0e4_189",ae="_dropzoneText_wc0e4_199",te="_previewImg_wc0e4_221",le="_formTextarea_wc0e4_235",re="_formActions_wc0e4_269",ne="_cancelBtn_wc0e4_281",ce="_submitBtn_wc0e4_311",ie="_galleryGrid_wc0e4_353",oe="_galleryCard_wc0e4_369",ge="_galleryImageWrap_wc0e4_393",me="_galleryImage_wc0e4_393",de="_galleryInfo_wc0e4_427",_e="_galleryTitle_wc0e4_435",ue="_galleryDesc_wc0e4_451",pe="_galleryMeta_wc0e4_467",ye="_galleryAuthor_wc0e4_483",he="_galleryMetaRight_wc0e4_491",we="_galleryViewCount_wc0e4_503",fe="_galleryDate_wc0e4_511",xe="_deleteBtn_wc0e4_519",je="_loginPrompt_wc0e4_551",Ne="_loginLink_wc0e4_581",be="_feedback_wc0e4_613",ve="_success_wc0e4_631",Ie="_error_wc0e4_643",ke="_empty_wc0e4_655",a={page:q,backLink:O,header:X,subtitle:Z,writeArea:J,writeBtn:K,form:Q,formInput:Y,dropzone:ee,dragging:se,dropzoneText:ae,previewImg:te,formTextarea:le,formActions:re,cancelBtn:ne,submitBtn:ce,galleryGrid:ie,galleryCard:oe,galleryImageWrap:ge,galleryImage:me,galleryInfo:de,galleryTitle:_e,galleryDesc:ue,galleryMeta:pe,galleryAuthor:ye,galleryMetaRight:he,galleryViewCount:we,galleryDate:fe,deleteBtn:xe,loginPrompt:je,loginLink:Ne,feedback:be,success:ve,error:Ie,empty:ke},De=5*1024*1024;function Le(){const{items:f,loading:T,createItem:B,deleteItem:C}=E(),A=H("hohai_gallery"),{isLoggedIn:i,profile:o,user:c}=P(),[L,g]=r.useState(!1),[m,d]=r.useState(""),[x,_]=r.useState(""),[u,p]=r.useState(null),[j,y]=r.useState(null),[S,h]=r.useState(!1),[N,b]=r.useState(!1),[w,l]=r.useState(null),v=r.useRef(null),I=s=>{if(s.size>De){l({type:"error",message:"파일 크기는 5MB 이하만 가능합니다."}),setTimeout(()=>l(null),3e3);return}if(!s.type.startsWith("image/")){l({type:"error",message:"이미지 파일만 업로드 가능합니다."}),setTimeout(()=>l(null),3e3);return}p(s);const t=new FileReader;t.onload=n=>{var k;return y((k=n.target)==null?void 0:k.result)},t.readAsDataURL(s)},M=s=>{s.preventDefault(),h(!1);const t=s.dataTransfer.files[0];t&&I(t)},z=async s=>{if(s.preventDefault(),!(!m.trim()||!u||!i||!c)){b(!0),l(null);try{const t=await $(u,c.id),{error:n}=await B({title:m.trim(),image_url:t,description:x.trim(),author_name:(o==null?void 0:o.display_name)||c.email||"익명",user_id:c.id});n?l({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(l({type:"success",message:"갤러리에 등록되었습니다."}),d(""),_(""),p(null),y(null),g(!1))}catch{l({type:"error",message:"이미지 업로드에 실패했습니다."})}b(!1),setTimeout(()=>l(null),3e3)}},R=async(s,t)=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:n}=await C(s,t);l(n?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>l(null),3e3)},F=()=>{g(!1),d(""),_(""),p(null),y(null)};return e.jsxs(G,{children:[e.jsxs(V,{children:[e.jsx("title",{children:"갤러리 — 好海"}),e.jsx("meta",{name:"description",content:"好海 갤러리 — 이미지와 함께 추억을 공유하세요"})]}),e.jsx("div",{className:a.page,children:e.jsxs("div",{className:"container",children:[e.jsx(D,{to:"/community",className:a.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:a.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"갤러리"}),e.jsx("p",{className:a.subtitle,children:"이미지와 함께 추억을 공유하세요"})]}),w&&e.jsx("div",{className:`${a.feedback} ${a[w.type]}`,children:w.message}),e.jsx("div",{className:a.writeArea,children:i?L?e.jsxs("form",{className:a.form,onSubmit:z,children:[e.jsx("input",{className:a.formInput,type:"text",placeholder:"제목",value:m,onChange:s=>d(s.target.value),required:!0}),e.jsxs("div",{className:`${a.dropzone} ${S?a.dragging:""}`,onDragOver:s=>{s.preventDefault(),h(!0)},onDragLeave:()=>h(!1),onDrop:M,onClick:()=>{var s;return(s=v.current)==null?void 0:s.click()},children:[j?e.jsx("img",{src:j,alt:"미리보기",className:a.previewImg}):e.jsxs("p",{className:a.dropzoneText,children:["이미지를 드래그하거나 클릭하여 업로드",e.jsx("br",{}),e.jsx("small",{children:"(최대 5MB)"})]}),e.jsx("input",{ref:v,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>{var n;const t=(n=s.target.files)==null?void 0:n[0];t&&I(t)}})]}),e.jsx("textarea",{className:a.formTextarea,placeholder:"설명 (선택사항)",value:x,onChange:s=>_(s.target.value),rows:3}),e.jsxs("div",{className:a.formActions,children:[e.jsx("button",{type:"button",className:a.cancelBtn,onClick:F,children:"취소"}),e.jsx("button",{type:"submit",className:a.submitBtn,disabled:N||!u,children:N?"등록 중...":"등록"})]})]}):e.jsx("button",{className:a.writeBtn,onClick:()=>g(!0),children:"사진 올리기"}):e.jsxs("div",{className:a.loginPrompt,children:[e.jsx("p",{children:"로그인 후 갤러리에 사진을 올려주세요"}),e.jsx(D,{to:"/login",className:a.loginLink,children:"로그인하기"})]})}),T?e.jsx("p",{className:a.empty,children:"불러오는 중..."}):f.length>0?e.jsx("div",{className:a.galleryGrid,children:f.map((s,t)=>e.jsxs(W.article,{className:a.galleryCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:t*.05},children:[e.jsx("div",{className:a.galleryImageWrap,onClick:()=>A(s.id),children:e.jsx("img",{src:s.image_url,alt:s.title,className:a.galleryImage})}),e.jsxs("div",{className:a.galleryInfo,children:[e.jsx("h3",{className:a.galleryTitle,children:s.title}),s.description&&e.jsx("p",{className:a.galleryDesc,children:s.description}),e.jsxs("div",{className:a.galleryMeta,children:[e.jsx("span",{className:a.galleryAuthor,children:s.author_name}),e.jsxs("span",{className:a.galleryMetaRight,children:[e.jsxs("span",{className:a.galleryViewCount,children:["조회 ",s.view_count??0]}),e.jsx("span",{className:a.galleryDate,children:U(s.created_at)})]})]}),i&&(c==null?void 0:c.id)===s.user_id&&e.jsx("button",{className:a.deleteBtn,onClick:()=>R(s.id,s.image_url),children:"삭제"})]})]},s.id))}):e.jsx("p",{className:a.empty,children:"아직 갤러리에 사진이 없습니다. 첫 번째 사진을 올려주세요!"})]})})]})}export{Le as default};
