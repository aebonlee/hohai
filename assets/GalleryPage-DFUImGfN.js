import{f as G,r,j as e,P as M,H as R,L as D,m as W}from"./index-BqxgY0Ws.js";import{u as E,a as $}from"./useGallery-Dv2WHq8c.js";import{f as H}from"./formatDate-teZXCzp_.js";const U="_page_9btgv_1",q="_backLink_9btgv_5",O="_header_9btgv_18",V="_subtitle_9btgv_23",X="_writeArea_9btgv_30",Z="_writeBtn_9btgv_35",J="_form_9btgv_55",K="_formInput_9btgv_65",Q="_dropzone_9btgv_80",Y="_dragging_9btgv_95",ee="_dropzoneText_9btgv_100",te="_previewImg_9btgv_111",se="_formTextarea_9btgv_118",ae="_formActions_9btgv_135",le="_cancelBtn_9btgv_141",re="_submitBtn_9btgv_156",ne="_galleryGrid_9btgv_177",ie="_galleryCard_9btgv_185",ce="_galleryImageWrap_9btgv_197",oe="_galleryImage_9btgv_197",ge="_galleryInfo_9btgv_214",me="_galleryTitle_9btgv_218",de="_galleryDesc_9btgv_226",_e="_galleryMeta_9btgv_234",ue="_galleryAuthor_9btgv_242",pe="_galleryDate_9btgv_246",ye="_deleteBtn_9btgv_250",be="_loginPrompt_9btgv_266",he="_loginLink_9btgv_281",fe="_feedback_9btgv_297",ve="_success_9btgv_306",xe="_error_9btgv_312",je="_empty_9btgv_318",s={page:U,backLink:q,header:O,subtitle:V,writeArea:X,writeBtn:Z,form:J,formInput:K,dropzone:Q,dragging:Y,dropzoneText:ee,previewImg:te,formTextarea:se,formActions:ae,cancelBtn:le,submitBtn:re,galleryGrid:ne,galleryCard:ie,galleryImageWrap:ce,galleryImage:oe,galleryInfo:ge,galleryTitle:me,galleryDesc:de,galleryMeta:_e,galleryAuthor:ue,galleryDate:pe,deleteBtn:ye,loginPrompt:be,loginLink:he,feedback:fe,success:ve,error:xe,empty:je},Ne=5*1024*1024;function De(){const{items:f,loading:T,createItem:B,deleteItem:A}=E(),{isLoggedIn:c,profile:o,user:i}=G(),[L,g]=r.useState(!1),[m,d]=r.useState(""),[v,_]=r.useState(""),[u,p]=r.useState(null),[x,y]=r.useState(null),[S,b]=r.useState(!1),[j,N]=r.useState(!1),[h,l]=r.useState(null),I=r.useRef(null),w=t=>{if(t.size>Ne){l({type:"error",message:"파일 크기는 5MB 이하만 가능합니다."}),setTimeout(()=>l(null),3e3);return}if(!t.type.startsWith("image/")){l({type:"error",message:"이미지 파일만 업로드 가능합니다."}),setTimeout(()=>l(null),3e3);return}p(t);const a=new FileReader;a.onload=n=>{var k;return y((k=n.target)==null?void 0:k.result)},a.readAsDataURL(t)},C=t=>{t.preventDefault(),b(!1);const a=t.dataTransfer.files[0];a&&w(a)},z=async t=>{if(t.preventDefault(),!(!m.trim()||!u||!c||!i)){N(!0),l(null);try{const a=await $(u,i.id),{error:n}=await B({title:m.trim(),image_url:a,description:v.trim(),author_name:(o==null?void 0:o.display_name)||i.email||"익명",user_id:i.id});n?l({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(l({type:"success",message:"갤러리에 등록되었습니다."}),d(""),_(""),p(null),y(null),g(!1))}catch{l({type:"error",message:"이미지 업로드에 실패했습니다."})}N(!1),setTimeout(()=>l(null),3e3)}},F=async(t,a)=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:n}=await A(t,a);l(n?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>l(null),3e3)},P=()=>{g(!1),d(""),_(""),p(null),y(null)};return e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx("title",{children:"갤러리 — 好海"}),e.jsx("meta",{name:"description",content:"好海 갤러리 — 이미지와 함께 추억을 공유하세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(D,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"갤러리"}),e.jsx("p",{className:s.subtitle,children:"이미지와 함께 추억을 공유하세요"})]}),h&&e.jsx("div",{className:`${s.feedback} ${s[h.type]}`,children:h.message}),e.jsx("div",{className:s.writeArea,children:c?L?e.jsxs("form",{className:s.form,onSubmit:z,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>d(t.target.value),required:!0}),e.jsxs("div",{className:`${s.dropzone} ${S?s.dragging:""}`,onDragOver:t=>{t.preventDefault(),b(!0)},onDragLeave:()=>b(!1),onDrop:C,onClick:()=>{var t;return(t=I.current)==null?void 0:t.click()},children:[x?e.jsx("img",{src:x,alt:"미리보기",className:s.previewImg}):e.jsxs("p",{className:s.dropzoneText,children:["이미지를 드래그하거나 클릭하여 업로드",e.jsx("br",{}),e.jsx("small",{children:"(최대 5MB)"})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:t=>{var n;const a=(n=t.target.files)==null?void 0:n[0];a&&w(a)}})]}),e.jsx("textarea",{className:s.formTextarea,placeholder:"설명 (선택사항)",value:v,onChange:t=>_(t.target.value),rows:3}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:P,children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:j||!u,children:j?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>g(!0),children:"사진 올리기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 갤러리에 사진을 올려주세요"}),e.jsx(D,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),T?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):f.length>0?e.jsx("div",{className:s.galleryGrid,children:f.map((t,a)=>e.jsxs(W.article,{className:s.galleryCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:a*.05},children:[e.jsx("div",{className:s.galleryImageWrap,children:e.jsx("img",{src:t.image_url,alt:t.title,className:s.galleryImage})}),e.jsxs("div",{className:s.galleryInfo,children:[e.jsx("h3",{className:s.galleryTitle,children:t.title}),t.description&&e.jsx("p",{className:s.galleryDesc,children:t.description}),e.jsxs("div",{className:s.galleryMeta,children:[e.jsx("span",{className:s.galleryAuthor,children:t.author_name}),e.jsx("span",{className:s.galleryDate,children:H(t.created_at)})]}),c&&(i==null?void 0:i.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>F(t.id,t.image_url),children:"삭제"})]})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 갤러리에 사진이 없습니다. 첫 번째 사진을 올려주세요!"})]})})]})}export{De as default};
