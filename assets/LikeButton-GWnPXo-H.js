import{r as c,j as t,s as d,f as y,a as p}from"./index-BCkJtvyK.js";const b="_btn_yzya4_1",j="_copied_yzya4_24",x={btn:b,copied:j};function q({title:e,text:s,url:o}){const[r,n]=c.useState(!1),i=o||window.location.href,l=c.useCallback(async()=>{if(navigator.share)try{await navigator.share({title:e,text:s||e,url:i});return}catch{return}try{await navigator.clipboard.writeText(i),n(!0),setTimeout(()=>n(!1),2e3)}catch{const a=document.createElement("textarea");a.value=i,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),n(!0),setTimeout(()=>n(!1),2e3)}},[e,s,i]);return t.jsx("button",{className:`${x.btn} ${r?x.copied:""}`,onClick:l,title:"공유하기",children:r?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})}),"복사됨"]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"18",cy:"5",r:"3"}),t.jsx("circle",{cx:"6",cy:"12",r:"3"}),t.jsx("circle",{cx:"18",cy:"19",r:"3"}),t.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),t.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),"공유"]})})}const w="즐겨찾기";function E(e){const[s,o]=c.useState(0);return c.useEffect(()=>{if(!e)return;(async()=>{const{data:n}=await d.from("hohai_playlists").select("id").eq("name",w).contains("song_ids",[e]);o((n==null?void 0:n.length)||0)})()},[e]),s}function g(e,s,o){const[r,n]=c.useState(0),[i,l]=c.useState(!1),[a,_]=c.useState(!0),f=c.useCallback(async()=>{if(!s)return;const{count:u}=await d.from("hohai_likes").select("*",{count:"exact",head:!0}).eq("target_type",e).eq("target_id",s);if(n(u||0),o){const{data:m}=await d.from("hohai_likes").select("id").eq("target_type",e).eq("target_id",s).eq("user_id",o).maybeSingle();l(!!m)}_(!1)},[e,s,o]);c.useEffect(()=>{f()},[f]);const k=c.useCallback(async()=>{!o||!s||(i?(await d.from("hohai_likes").delete().eq("user_id",o).eq("target_type",e).eq("target_id",s),l(!1),n(u=>Math.max(0,u-1))):(await d.from("hohai_likes").insert({user_id:o,target_type:e,target_id:s}),l(!0),n(u=>u+1)))},[i,o,e,s]);return{count:r,liked:i,loading:a,toggle:k}}const C="_btn_8wzdz_1",v="_liked_8wzdz_24",z="_heart_8wzdz_30",L="_count_8wzdz_40",h={btn:C,liked:v,heart:z,count:L};function N({targetType:e,targetId:s}){const{isLoggedIn:o,user:r}=y(),n=p(),{count:i,liked:l,toggle:a}=g(e,s,r==null?void 0:r.id),_=()=>{if(!o){n("/login");return}a()};return t.jsxs("button",{className:`${h.btn} ${l?h.liked:""}`,onClick:_,title:l?"좋아요 취소":"좋아요",children:[t.jsx("span",{className:h.heart,children:l?"♥":"♡"}),"좋아요",i>0&&t.jsx("span",{className:h.count,children:i})]})}export{N as L,q as S,E as a,g as u};
