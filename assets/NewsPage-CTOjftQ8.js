import{f as C,r as i,j as e,P as v,H as B,L as x,m as L}from"./index-CE2Wc_m1.js";import{u as A}from"./useNews-Da7XuhR6.js";import{f as T}from"./formatDate-teZXCzp_.js";const H="_page_1ylw2_1",S="_backLink_1ylw2_5",I="_header_1ylw2_18",D="_subtitle_1ylw2_23",P="_writeArea_1ylw2_30",R="_writeBtn_1ylw2_35",V="_form_1ylw2_55",F="_formInput_1ylw2_65",q="_formTextarea_1ylw2_80",E="_formActions_1ylw2_97",$="_cancelBtn_1ylw2_103",z="_submitBtn_1ylw2_118",G="_newsList_1ylw2_139",J="_newsCard_1ylw2_147",K="_newsHeader_1ylw2_159",M="_newsTitle_1ylw2_167",O="_newsHeaderRight_1ylw2_175",Q="_newsViewCount_1ylw2_182",U="_newsDate_1ylw2_187",W="_newsContent_1ylw2_192",X="_newsAuthor_1ylw2_201",Y="_deleteBtn_1ylw2_207",Z="_loginPrompt_1ylw2_222",ee="_loginLink_1ylw2_237",se="_feedback_1ylw2_253",te="_success_1ylw2_262",ne="_error_1ylw2_268",ae="_empty_1ylw2_274",s={page:H,backLink:S,header:I,subtitle:D,writeArea:P,writeBtn:R,form:V,formInput:F,formTextarea:q,formActions:E,cancelBtn:$,submitBtn:z,newsList:G,newsCard:J,newsHeader:K,newsTitle:M,newsHeaderRight:O,newsViewCount:Q,newsDate:U,newsContent:W,newsAuthor:X,deleteBtn:Y,loginPrompt:Z,loginLink:ee,feedback:se,success:te,error:ne,empty:ae};function re(){const{items:h,loading:f,createItem:j,deleteItem:g}=A(),{isLoggedIn:c,profile:r,user:n}=C(),[N,o]=i.useState(!1),[m,d]=i.useState(""),[_,w]=i.useState(""),[y,p]=i.useState(!1),[u,a]=i.useState(null),b=async t=>{if(t.preventDefault(),!m.trim()||!_.trim()||!c)return;p(!0),a(null);const{error:l}=await j({title:m.trim(),content:_.trim(),author_name:(r==null?void 0:r.display_name)||(n==null?void 0:n.email)||"익명",user_id:(n==null?void 0:n.id)||null});l?a({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(a({type:"success",message:"소식이 등록되었습니다."}),d(""),w(""),o(!1)),p(!1),setTimeout(()=>a(null),3e3)},k=async t=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:l}=await g(t);a(l?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>a(null),3e3)};return e.jsxs(v,{children:[e.jsxs(B,{children:[e.jsx("title",{children:"소식통 — 好海"}),e.jsx("meta",{name:"description",content:"好海 소식통 — 소식과 이야기를 전해주세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(x,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"소식통"}),e.jsx("p",{className:s.subtitle,children:"소식과 이야기를 전해주세요"})]}),u&&e.jsx("div",{className:`${s.feedback} ${s[u.type]}`,children:u.message}),e.jsx("div",{className:s.writeArea,children:c?N?e.jsxs("form",{className:s.form,onSubmit:b,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>d(t.target.value),required:!0}),e.jsx("textarea",{className:s.formTextarea,placeholder:"내용을 작성해주세요...",value:_,onChange:t=>w(t.target.value),required:!0,rows:5}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>{o(!1),d(""),w("")},children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:y,children:y?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>o(!0),children:"소식 작성하기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 소식을 전해주세요"}),e.jsx(x,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),f?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):h.length>0?e.jsx("div",{className:s.newsList,children:h.map((t,l)=>e.jsxs(L.article,{className:s.newsCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:l*.05},children:[e.jsxs("div",{className:s.newsHeader,children:[e.jsx("h3",{className:s.newsTitle,children:t.title}),e.jsxs("div",{className:s.newsHeaderRight,children:[e.jsxs("span",{className:s.newsViewCount,children:["조회 ",t.view_count??0]}),e.jsx("span",{className:s.newsDate,children:T(t.created_at)}),c&&(n==null?void 0:n.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>k(t.id),children:"삭제"})]})]}),e.jsx("p",{className:s.newsContent,children:t.content}),e.jsx("span",{className:s.newsAuthor,children:t.author_name})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 소식이 없습니다. 첫 번째 소식을 전해주세요!"})]})})]})}export{re as default};
