import{r as a,f as q,w as K,a as z,j as e,o as U,m as G,t as $}from"./index-BqxgY0Ws.js";import{u as J,a as Q,L as X,S as Z}from"./LikeButton-Bc-BjT1g.js";let T=!1,R=!1;const I=[];function ee(){return R&&window.YT?Promise.resolve():new Promise(t=>{if(I.push(t),T)return;T=!0;const c=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{R=!0,T=!1,c==null||c(),I.forEach(i=>i()),I.length=0},document.querySelector('script[src*="youtube.com/iframe_api"]')){window.YT&&window.YT.Player&&(R=!0,T=!1,I.forEach(i=>i()),I.length=0);return}const o=document.createElement("script");o.src="https://www.youtube.com/iframe_api",o.async=!0,document.head.appendChild(o)})}function te({containerId:t,videoId:c,autoplay:o,enabled:i,onEnd:k,onPlay:N}){const u=a.useRef(null),d=a.useRef(k),r=a.useRef(N);d.current=k,r.current=N;const m=a.useCallback(()=>{var p;try{(p=u.current)==null||p.destroy()}catch{}u.current=null},[]);return a.useEffect(()=>{if(!i||!c){m();return}let p=!1;return ee().then(()=>{p||!window.YT||(m(),!document.getElementById(t))||(u.current=new window.YT.Player(t,{videoId:c,playerVars:{autoplay:o?1:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1},events:{onStateChange:_=>{var j,b;_.data===0&&((j=d.current)==null||j.call(d)),_.data===1&&((b=r.current)==null||b.call(r))}}}))}),()=>{p=!0,m()}},[i,c,t,o,m]),{destroyPlayer:m}}const se="_wrapper_1p6jo_1",ne="_favBtn_1p6jo_9",ae="_star_1p6jo_28",ie="_favActive_1p6jo_43",le="_moreBtn_1p6jo_54",ce="_dropdown_1p6jo_75",oe="_dropdownHeader_1p6jo_88",re="_empty_1p6jo_98",ue="_dropdownItem_1p6jo_104",de="_included_1p6jo_123",me="_itemCheck_1p6jo_127",pe="_itemName_1p6jo_133",_e="_itemCount_1p6jo_140",ye="_createBtn_1p6jo_146",he="_createForm_1p6jo_165",fe="_createInput_1p6jo_172",we="_createConfirm_1p6jo_188",l={wrapper:se,favBtn:ne,star:ae,favActive:ie,moreBtn:le,dropdown:ce,dropdownHeader:oe,empty:re,dropdownItem:ue,included:de,itemCheck:me,itemName:pe,itemCount:_e,createBtn:ye,createForm:he,createInput:fe,createConfirm:we},V="즐겨찾기";function je({songId:t}){const{isLoggedIn:c,user:o}=q(),{playlists:i,createPlaylist:k,addSongToPlaylist:N,removeSongFromPlaylist:u}=K(),d=z(),[r,m]=a.useState(!1),[p,w]=a.useState(!1),[_,j]=a.useState(""),[b,P]=a.useState(!1),g=a.useRef(null),x=i.find(n=>n.name===V),y=x?x.song_ids.includes(t):!1;a.useEffect(()=>{if(!r)return;const n=h=>{g.current&&!g.current.contains(h.target)&&(m(!1),w(!1))};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[r]);const S=async n=>{if(n.stopPropagation(),!c){d("/login");return}if(!b){P(!0);try{x?y?await u(x.id,t):await N(x.id,t):await k({user_id:o.id,name:V,song_ids:[t]})}finally{P(!1)}}},A=n=>{if(n.stopPropagation(),!c){d("/login");return}m(!r),w(!1)},L=async n=>{await N(n,t)},C=async n=>{await u(n,t)},v=async()=>{!_.trim()||!o||(await k({user_id:o.id,name:_.trim(),song_ids:[t]}),j(""),w(!1))},B=n=>{n.key==="Enter"&&v(),n.key==="Escape"&&w(!1)};return e.jsxs("div",{className:l.wrapper,ref:g,children:[e.jsxs("button",{className:`${l.favBtn} ${y?l.favActive:""}`,onClick:S,disabled:b,"aria-label":y?"즐겨찾기에서 제거":"즐겨찾기에 추가",title:y?"즐겨찾기에서 이 곡을 제거합니다":"이 곡을 즐겨찾기에 추가합니다",children:[e.jsx("span",{className:l.star,children:y?"★":"☆"}),"즐겨찾기"]}),e.jsx("button",{className:l.moreBtn,onClick:A,"aria-label":"다른 재생목록에 추가",title:"다른 재생목록을 선택하여 곡을 추가합니다",children:"▾"}),r&&e.jsxs("div",{className:l.dropdown,children:[e.jsx("div",{className:l.dropdownHeader,children:"재생목록에 추가"}),i.length===0&&!p&&e.jsx("div",{className:l.empty,children:"재생목록이 없습니다"}),i.map(n=>{const h=n.song_ids.includes(t);return e.jsxs("button",{className:`${l.dropdownItem} ${h?l.included:""}`,onClick:()=>h?C(n.id):L(n.id),children:[e.jsx("span",{className:l.itemCheck,children:h?"✓":""}),e.jsx("span",{className:l.itemName,children:n.name}),e.jsxs("span",{className:l.itemCount,children:[n.song_ids.length,"곡"]})]},n.id)}),p?e.jsxs("div",{className:l.createForm,children:[e.jsx("input",{className:l.createInput,type:"text",value:_,onChange:n=>j(n.target.value),onKeyDown:B,placeholder:"재생목록 이름",autoFocus:!0,maxLength:50}),e.jsx("button",{className:l.createConfirm,onClick:v,disabled:!_.trim(),children:"확인"})]}):e.jsx("button",{className:l.createBtn,onClick:()=>w(!0),children:"+ 새 재생목록 만들기"})]})]})}function xe(t){return t.split(`
`).filter(c=>!/^\s*\[.*\]\s*$/.test(c)).join(`
`).replace(/\n{3,}/g,`

`).trim()}const ve="_card_pwkl9_1",ke="_thumbnail_pwkl9_13",Ne="_thumbnailImg_pwkl9_22",be="_playBtn_pwkl9_33",ge="_sourceBadge_pwkl9_64",Ce="_ytContainer_pwkl9_84",Pe="_sunoPlaceholder_pwkl9_90",Be="_sunoLabel_pwkl9_109",Ie="_sunoPlayIcon_pwkl9_115",Se="_sunoIframe_pwkl9_146",Le="_sunoSection_pwkl9_154",Te="_sunoBtn_pwkl9_164",Ae="_playlistNav_pwkl9_185",Ee="_navBtn_pwkl9_195",Re="_navPosition_pwkl9_215",Fe="_info_pwkl9_223",Ye="_statsRow_pwkl9_227",$e="_counts_pwkl9_236",Ve="_countItem_pwkl9_242",qe="_actions_pwkl9_256",Oe="_title_pwkl9_262",He="_description_pwkl9_270",De="_tags_pwkl9_281",Me="_tag_pwkl9_281",We="_lyricsActions_pwkl9_297",Ke="_lyricsToggle_pwkl9_305",ze="_lyricsPlayerBtn_pwkl9_322",Ue="_lyrics_pwkl9_297",s={card:ve,thumbnail:ke,thumbnailImg:Ne,playBtn:be,sourceBadge:ge,ytContainer:Ce,sunoPlaceholder:Pe,sunoLabel:Be,sunoPlayIcon:Ie,sunoIframe:Se,sunoSection:Le,sunoBtn:Te,playlistNav:Ae,navBtn:Ee,navPosition:Re,info:Fe,statsRow:Ye,counts:$e,countItem:Ve,actions:qe,title:Oe,description:He,tags:De,tag:Me,lyricsActions:We,lyricsToggle:Ke,lyricsPlayerBtn:ze,lyrics:Ue};function Ze({song:t,index:c=0,contextPlaylist:o}){const{currentId:i,play:k,onSongEnd:N,playlist:u,currentIndex:d,hasNext:r,hasPrev:m,next:p,prev:w,setPlaylist:_,autoPlayIntent:j,openLyricsPlayer:b}=U(),[P,g]=a.useState(!1),[x,y]=a.useState(!1),[S,A]=a.useState(!1),L=a.useRef(null),C=!!t.youtube_id,v=!!t.suno_url,{user:B}=q(),{count:n}=J("song",t.id,B==null?void 0:B.id),h=Q(t.id),O=!!t.lyrics,H=t.tags&&t.tags.length>0,D=u!==null&&i===t.id&&d>=0,F=`yt-${a.useId().replace(/:/g,"")}`;a.useEffect(()=>{i&&i!==t.id&&(g(!1),y(!1))},[i,t.id]),a.useEffect(()=>{i===t.id&&j&&(C?g(!0):v&&y(!0),requestAnimationFrame(()=>{var f;(f=L.current)==null||f.scrollIntoView({behavior:"smooth",block:"center"})}))},[i,t.id,j,C,v]),te({containerId:F,videoId:t.youtube_id||null,autoplay:!0,enabled:P&&C,onEnd:()=>{N()}});const E=f=>{o&&o.length>0&&_(o),k(f)},M=()=>{E(t.id),g(!0)},Y=()=>{E(t.id),y(!0)},W=()=>{E(t.id),b()};return e.jsxs(G.article,{ref:L,className:s.card,initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-40px"},transition:{duration:.5,delay:c*.1},children:[e.jsx("div",{className:s.thumbnail,children:C?P?e.jsx("div",{id:F,className:s.ytContainer}):e.jsxs(e.Fragment,{children:[e.jsx("img",{className:s.thumbnailImg,src:`https://img.youtube.com/vi/${t.youtube_id}/hqdefault.jpg`,alt:t.title,loading:"lazy"}),e.jsx("button",{className:s.playBtn,onClick:M,"aria-label":`${t.title} 재생`,title:"클릭하면 노래가 재생됩니다"}),v&&e.jsx("span",{className:s.sourceBadge,children:"YouTube"})]}):v?x?e.jsx("iframe",{className:s.sunoIframe,src:$(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("div",{className:s.sunoPlaceholder,onClick:Y,title:"클릭하면 노래가 재생됩니다",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),e.jsx("span",{className:s.sunoLabel,children:"음원 재생"}),e.jsx("div",{className:s.sunoPlayIcon})]}):null}),C&&v&&e.jsx("div",{className:s.sunoSection,children:x?e.jsx("iframe",{className:s.sunoIframe,src:$(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("button",{className:s.sunoBtn,onClick:Y,title:"음원 버전을 재생합니다",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),"음원 듣기"]})}),D&&u&&e.jsxs("div",{className:s.playlistNav,children:[e.jsx("button",{className:s.navBtn,onClick:w,disabled:!m,"aria-label":"이전 곡",title:"이전 곡으로 이동합니다",children:"⏮"}),e.jsxs("span",{className:s.navPosition,children:[d+1," / ",u.length]}),e.jsx("button",{className:s.navBtn,onClick:p,disabled:!r,"aria-label":"다음 곡",title:"다음 곡으로 이동합니다",children:"⏭"})]}),e.jsxs("div",{className:s.info,children:[e.jsx("h3",{className:s.title,children:t.title}),e.jsxs("div",{className:s.statsRow,children:[(n>0||h>0)&&e.jsxs("div",{className:s.counts,children:[n>0&&e.jsxs("span",{className:s.countItem,children:["♥ ",n]}),h>0&&e.jsxs("span",{className:s.countItem,children:["★ ",h]})]}),e.jsxs("div",{className:s.actions,children:[e.jsx(je,{songId:t.id}),e.jsx(X,{targetType:"song",targetId:t.id}),e.jsx(Z,{title:t.title,text:t.description||t.title})]})]}),t.description&&e.jsx("p",{className:s.description,children:t.description}),H&&e.jsx("div",{className:s.tags,children:t.tags.map(f=>e.jsxs("span",{className:s.tag,children:["#",f]},f))}),O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.lyricsActions,children:[e.jsx("button",{className:s.lyricsToggle,onClick:()=>A(f=>!f),title:"가사를 펼치거나 접습니다",children:S?"가사 접기 ▲":"가사 보기 ▼"}),e.jsx("button",{className:s.lyricsPlayerBtn,onClick:W,title:"전체 화면으로 가사를 보면서 들을 수 있습니다",children:"가사 플레이어"})]}),S&&e.jsx("div",{className:s.lyrics,children:xe(t.lyrics)})]})]})]})}export{je as A,Ze as S,xe as c,te as u};
