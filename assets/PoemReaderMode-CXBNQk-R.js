import{r as o,j as n,A as D,m as L,i as k,l as I,h as S}from"./index-BCkJtvyK.js";import{r as $,L as B}from"./LyricsEffects-Aor13UAq.js";const M="_overlay_qlybd_18",P="_header_qlybd_34",z="_closeBtn_qlybd_52",H="_seriesName_qlybd_76",G="_position_qlybd_87",W="_scrollContainer_qlybd_96",F="_slide_qlybd_112",K="_slideLong_qlybd_128",V="_slideInner_qlybd_133",J="_poemCategory_qlybd_139",Q="_poemTitle_qlybd_148",U="_poemDate_qlybd_157",X="_poemContent_qlybd_164",Y="_stanza_qlybd_172",Z="_poemTags_qlybd_181",O="_poemTag_qlybd_181",ee="_hint_qlybd_200",te="_hintArrow_qlybd_222",ne="_dots_qlybd_228",se="_dot_qlybd_228",oe="_dotActive_qlybd_251",s={overlay:M,header:P,closeBtn:z,seriesName:H,position:G,scrollContainer:W,slide:F,slideLong:K,slideInner:V,poemCategory:J,poemTitle:Q,poemDate:U,poemContent:X,stanza:Y,poemTags:Z,poemTag:O,hint:ee,hintArrow:te,dots:ne,dot:se,dotActive:oe};function re(c){return S[c]?c:"default"}function le({poems:c,initialIndex:d,seriesName:b,isOpen:r,onClose:l}){const[u,N]=o.useState(d),[q,w]=o.useState(!0),m=o.useRef(null),j=o.useRef(null),v=o.useRef(null),g=o.useRef(null),f=o.useRef([]),p=o.useRef(null),_=c[u]?re(c[u].category):"default",h=I[_],E=k[_],x=o.useCallback(e=>{if(e.key==="Escape"){l();return}if(e.key==="Tab"&&g.current){const t=g.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(t.length===0)return;const a=t[0],y=t[t.length-1];e.shiftKey?document.activeElement===a&&(e.preventDefault(),y.focus()):document.activeElement===y&&(e.preventDefault(),a.focus())}},[l]);o.useEffect(()=>{if(!r)return;v.current=document.activeElement;const e=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",document.body.style.paddingRight=`${e}px`,requestAnimationFrame(()=>{var t;return(t=j.current)==null?void 0:t.focus()}),document.addEventListener("keydown",x),()=>{document.body.style.overflow="",document.body.style.paddingRight="",document.removeEventListener("keydown",x),v.current instanceof HTMLElement&&v.current.focus()}},[r,x]),o.useEffect(()=>{if(!r)return;const e=()=>l();return window.history.pushState(null,"",window.location.href),window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[r,l]),o.useEffect(()=>{if(!r||!m.current)return;N(d);const e=f.current[d];e&&e.scrollIntoView({behavior:"instant"})},[r,d]),o.useEffect(()=>{if(!(!r||!m.current))return p.current=new IntersectionObserver(e=>{for(const t of e)if(t.isIntersecting&&t.intersectionRatio>=.5){const a=Number(t.target.getAttribute("data-index"));isNaN(a)||N(a)}},{root:m.current,threshold:.5}),f.current.forEach(e=>{e&&p.current.observe(e)}),()=>{var e;(e=p.current)==null||e.disconnect()}},[r,c.length]),o.useEffect(()=>{if(!r)return;w(!0);const e=setTimeout(()=>w(!1),2600);return()=>clearTimeout(e)},[r]);const T=e=>{const t=f.current[e];t&&t.scrollIntoView({behavior:"smooth"})},R=e=>{e.target===e.currentTarget&&l()},A=e=>e.content.split(`
`).length>20;return $.createPortal(n.jsx(D,{children:r&&n.jsxs(L.div,{ref:g,className:s.overlay,role:"dialog","aria-modal":"true","aria-label":`${b||"시집"} — 읽기 모드`,onClick:R,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},style:{"--mood-c1":h.c1,"--mood-c2":h.c2,"--mood-c3":h.c3,"--mood-c4":h.c4,"--mood-accent":E},children:[n.jsx(B,{mood:_,isActive:r},_),n.jsxs("div",{className:s.header,children:[n.jsx("button",{ref:j,className:s.closeBtn,onClick:l,"aria-label":"닫기",children:"✕"}),b&&n.jsx("span",{className:s.seriesName,children:b}),n.jsxs("span",{className:s.position,children:[u+1,"/",c.length]})]}),c.length<=30&&n.jsx("div",{className:s.dots,children:c.map((e,t)=>n.jsx("button",{className:`${s.dot} ${t===u?s.dotActive:""}`,onClick:()=>T(t),"aria-label":`${t+1}번째 시로 이동`},t))}),n.jsx("div",{ref:m,className:s.scrollContainer,children:c.map((e,t)=>{const a=e.content.split(/\n\s*\n/).filter(Boolean),y=A(e);return n.jsx("div",{ref:i=>{f.current[t]=i},"data-index":t,className:`${s.slide} ${y?s.slideLong:""}`,children:n.jsxs("div",{className:s.slideInner,children:[n.jsx("div",{className:s.poemCategory,children:e.category}),n.jsx("h2",{className:s.poemTitle,children:e.title}),e.written_date&&n.jsx("p",{className:s.poemDate,children:e.written_date}),n.jsx("div",{className:s.poemContent,children:a.map((i,C)=>n.jsx("div",{className:s.stanza,children:i},C))}),e.tags&&e.tags.length>0&&n.jsx("div",{className:s.poemTags,children:e.tags.map(i=>n.jsxs("span",{className:s.poemTag,children:["#",i]},i))})]})},e.id)})}),q&&n.jsxs("div",{className:s.hint,children:[n.jsx("span",{className:s.hintArrow,children:"↕"}),"위아래로 스와이프하여 넘기기"]})]})}),document.body)}export{le as P};
