import{f as N,r,j as e,P as y,H as k,L as w,m as C}from"./index-BCkJtvyK.js";import{u as B}from"./useReviews-Ls6lRWjj.js";import{f as L}from"./formatDate-teZXCzp_.js";const A="_page_1b82b_1",H="_backLink_1b82b_5",R="_header_1b82b_18",S="_subtitle_1b82b_23",D="_writeArea_1b82b_30",P="_writeBtn_1b82b_35",T="_form_1b82b_55",I="_formInput_1b82b_65",V="_formTextarea_1b82b_80",F="_formActions_1b82b_97",E="_cancelBtn_1b82b_103",$="_submitBtn_1b82b_118",q="_reviewList_1b82b_139",z="_reviewCard_1b82b_147",G="_reviewHeader_1b82b_159",J="_reviewAuthor_1b82b_166",K="_reviewViewCount_1b82b_172",M="_reviewDate_1b82b_177",O="_reviewContent_1b82b_182",Q="_loginPrompt_1b82b_190",U="_loginLink_1b82b_205",W="_feedback_1b82b_221",X="_success_1b82b_230",Y="_error_1b82b_236",Z="_reviewHeaderRight_1b82b_242",ee="_deleteBtn_1b82b_248",te="_empty_1b82b_263",t={page:A,backLink:H,header:R,subtitle:S,writeArea:D,writeBtn:P,form:T,formInput:I,formTextarea:V,formActions:F,cancelBtn:E,submitBtn:$,reviewList:q,reviewCard:z,reviewHeader:G,reviewAuthor:J,reviewViewCount:K,reviewDate:M,reviewContent:O,loginPrompt:Q,loginLink:U,feedback:W,success:X,error:Y,reviewHeaderRight:Z,deleteBtn:ee,empty:te};function ae(){const{reviews:b,loading:p,createReview:v,deleteReview:x}=B(),{isLoggedIn:c,profile:o,user:n}=N(),[f,l]=r.useState(!1),[m,d]=r.useState(""),[u,h]=r.useState(!1),[_,i]=r.useState(null),j=async s=>{if(s.preventDefault(),!m.trim()||!c)return;h(!0),i(null);const{error:a}=await v({author_name:(o==null?void 0:o.display_name)||(n==null?void 0:n.email)||"익명",content:m.trim(),user_id:(n==null?void 0:n.id)||null});a?i({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(i({type:"success",message:"감상 후기가 등록되었습니다."}),d(""),l(!1)),h(!1),setTimeout(()=>i(null),3e3)},g=async s=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:a}=await x(s);i(a?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"후기가 삭제되었습니다."}),setTimeout(()=>i(null),3e3)};return e.jsxs(y,{children:[e.jsxs(k,{children:[e.jsx("title",{children:"감상 후기 — 好海"}),e.jsx("meta",{name:"description",content:"好海 이성헌 시인의 시와 노래에 대한 감상 후기"})]}),e.jsx("div",{className:t.page,children:e.jsxs("div",{className:"container",children:[e.jsx(w,{to:"/community",className:t.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:t.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"감상 후기"}),e.jsx("p",{className:t.subtitle,children:"시와 노래를 감상하신 소감을 나눠주세요"})]}),_&&e.jsx("div",{className:`${t.feedback} ${t[_.type]}`,children:_.message}),e.jsx("div",{className:t.writeArea,children:c?f?e.jsxs("form",{className:t.form,onSubmit:j,children:[e.jsx("textarea",{className:t.formTextarea,placeholder:"감상 후기를 작성해주세요...",value:m,onChange:s=>d(s.target.value),required:!0,rows:4}),e.jsxs("div",{className:t.formActions,children:[e.jsx("button",{type:"button",className:t.cancelBtn,onClick:()=>{l(!1),d("")},children:"취소"}),e.jsx("button",{type:"submit",className:t.submitBtn,disabled:u,children:u?"등록 중...":"등록"})]})]}):e.jsx("button",{className:t.writeBtn,onClick:()=>l(!0),children:"후기 작성하기"}):e.jsxs("div",{className:t.loginPrompt,children:[e.jsx("p",{children:"로그인 후 감상 후기를 남겨주세요"}),e.jsx(w,{to:"/login",className:t.loginLink,children:"로그인하기"})]})}),p?e.jsx("p",{className:t.empty,children:"불러오는 중..."}):b.length>0?e.jsx("div",{className:t.reviewList,children:b.map((s,a)=>e.jsxs(C.article,{className:t.reviewCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:a*.05},children:[e.jsxs("div",{className:t.reviewHeader,children:[e.jsx("span",{className:t.reviewAuthor,children:s.author_name}),e.jsxs("div",{className:t.reviewHeaderRight,children:[e.jsxs("span",{className:t.reviewViewCount,children:["조회 ",s.view_count??0]}),e.jsx("span",{className:t.reviewDate,children:L(s.created_at)}),c&&(n==null?void 0:n.id)===s.user_id&&e.jsx("button",{className:t.deleteBtn,onClick:()=>g(s.id),children:"삭제"})]})]}),e.jsx("p",{className:t.reviewContent,children:s.content})]},s.id))}):e.jsx("p",{className:t.empty,children:"아직 감상 후기가 없습니다. 첫 번째 후기를 남겨주세요!"})]})})]})}export{ae as default};
