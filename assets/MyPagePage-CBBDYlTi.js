import{f as q,a as G,r as t,j as e,P as J,H as K,x as Q,y as V,z as X,B as Y}from"./index-CNhTrOr2.js";/* empty css             */function se(){const{user:r,profile:s,signOut:A,refreshProfile:h,isAdmin:B}=q(),u=G(),[F,d]=t.useState(!1),[m,x]=t.useState({displayName:""}),[y,f]=t.useState(!1),[j,v]=t.useState(""),[_,z]=t.useState("success"),[D,p]=t.useState(!1),[i,o]=t.useState({newPassword:"",confirmPassword:""}),[w,N]=t.useState(!1),[E,b]=t.useState(!1),c=t.useRef(null),[M,P]=t.useState(!1),[g,C]=t.useState(""),[S,k]=t.useState(!1),R=!(s!=null&&s.provider)||s.provider==="email";t.useEffect(()=>{s&&x({displayName:s.display_name||""})},[s]);const n=(a,l="success")=>{v(a),z(l),setTimeout(()=>v(""),3e3)},U=async()=>{if(r){f(!0);try{await Q(r.id,{display_name:m.displayName}),await h(),d(!1),n("프로필이 업데이트되었습니다.")}catch(a){n(a.message,"error")}finally{f(!1)}}},W=async()=>{if(i.newPassword.length<6){n("비밀번호는 6자 이상이어야 합니다.","error");return}if(i.newPassword!==i.confirmPassword){n("비밀번호가 일치하지 않습니다.","error");return}N(!0);try{await V(i.newPassword),n("비밀번호가 변경되었습니다."),p(!1),o({newPassword:"",confirmPassword:""})}catch(a){n(a.message,"error")}finally{N(!1)}},H=()=>{var a;(a=c.current)==null||a.click()},I=async a=>{var T;const l=(T=a.target.files)==null?void 0:T[0];if(!(!l||!r)){if(!l.type.startsWith("image/")){n("이미지 파일만 업로드할 수 있습니다.","error");return}if(l.size>2*1024*1024){n("파일 크기는 2MB 이하여야 합니다.","error");return}b(!0);try{await X(r.id,l),await h(),n("프로필 사진이 변경되었습니다.")}catch($){n($.message,"error")}finally{b(!1),c.current&&(c.current.value="")}}},O=async()=>{if(g==="계정삭제"&&r){k(!0);try{await Y(r.id),u("/")}catch(a){n(a.message,"error"),k(!1)}}},L=async()=>{await A(),u("/")};return e.jsxs(J,{children:[e.jsx(K,{children:e.jsx("title",{children:"마이페이지 — 好海"})}),e.jsx("div",{className:"auth-section",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{className:"section-title",style:{textAlign:"center",marginBottom:"32px"},children:"마이페이지"}),e.jsxs("div",{className:"mypage-card",children:[e.jsxs("div",{className:"mypage-avatar",children:[e.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:I,style:{display:"none"}}),e.jsxs("div",{onClick:H,style:{cursor:"pointer",position:"relative"},title:"클릭하여 프로필 사진 변경",children:[s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.display_name||""}):e.jsx("div",{className:"mypage-avatar-placeholder",children:((s==null?void 0:s.display_name)||(r==null?void 0:r.email)||"?")[0].toUpperCase()}),E&&e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.7)",borderRadius:"50%"},children:e.jsx("div",{className:"loading-spinner"})})]}),e.jsx("span",{style:{fontSize:"0.75rem",color:"var(--text-muted)",marginTop:"8px"},children:"클릭하여 사진 변경"})]}),e.jsxs("div",{className:"mypage-info",children:[F?e.jsxs("div",{className:"mypage-edit-form",children:[e.jsxs("div",{className:"auth-form-group",children:[e.jsx("label",{children:"이름 (닉네임)"}),e.jsx("input",{type:"text",value:m.displayName,onChange:a=>x({...m,displayName:a.target.value})})]}),e.jsxs("div",{className:"mypage-edit-actions",children:[e.jsx("button",{className:"mypage-btn primary",onClick:U,disabled:y,children:y?"저장 중...":"저장"}),e.jsx("button",{className:"mypage-btn ghost",onClick:()=>d(!1),children:"취소"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mypage-name",children:(s==null?void 0:s.display_name)||"이름 없음"}),e.jsx("p",{className:"mypage-email",children:r==null?void 0:r.email}),e.jsx("p",{className:"mypage-provider",children:s!=null&&s.provider?`${s.provider} 로그인`:"이메일 계정"}),B&&e.jsx("span",{className:"mypage-role-badge",children:"관리자"}),e.jsx("button",{className:"mypage-btn ghost",onClick:()=>d(!0),style:{marginTop:"16px"},children:"프로필 수정"})]}),j&&e.jsx("div",{className:_==="error"?"auth-error":"auth-message",style:{marginTop:"12px"},children:j})]}),R&&e.jsx("div",{style:{borderTop:"1px solid rgba(7,26,51,0.08)",paddingTop:"20px",marginBottom:"20px"},children:D?e.jsxs("div",{className:"mypage-edit-form",style:{maxWidth:"100%"},children:[e.jsxs("div",{className:"auth-form-group",style:{marginBottom:"12px"},children:[e.jsx("label",{children:"새 비밀번호"}),e.jsx("input",{type:"password",value:i.newPassword,onChange:a=>o({...i,newPassword:a.target.value}),placeholder:"6자 이상",minLength:6})]}),e.jsxs("div",{className:"auth-form-group",style:{marginBottom:"12px"},children:[e.jsx("label",{children:"비밀번호 확인"}),e.jsx("input",{type:"password",value:i.confirmPassword,onChange:a=>o({...i,confirmPassword:a.target.value}),placeholder:"비밀번호 재입력"})]}),e.jsxs("div",{className:"mypage-edit-actions",children:[e.jsx("button",{className:"mypage-btn primary",onClick:W,disabled:w,children:w?"변경 중...":"비밀번호 변경"}),e.jsx("button",{className:"mypage-btn ghost",onClick:()=>{p(!1),o({newPassword:"",confirmPassword:""})},children:"취소"})]})]}):e.jsx("button",{className:"mypage-btn ghost",onClick:()=>p(!0),style:{width:"100%"},children:"비밀번호 변경"})}),e.jsx("div",{style:{borderTop:"1px solid rgba(7,26,51,0.08)",paddingTop:"20px",marginBottom:"20px"},children:M?e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("p",{style:{fontSize:"0.85rem",color:"#dc2626",marginBottom:"12px",fontWeight:600},children:"정말 계정을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-muted)",marginBottom:"12px"},children:'확인을 위해 "계정삭제"를 입력해주세요.'}),e.jsx("input",{type:"text",value:g,onChange:a=>C(a.target.value),placeholder:"계정삭제",style:{padding:"8px 12px",border:"1px solid #fca5a5",borderRadius:"6px",fontSize:"14px",marginBottom:"12px",width:"160px",textAlign:"center",fontFamily:"var(--font-sans)"}}),e.jsxs("div",{className:"mypage-edit-actions",children:[e.jsx("button",{className:"mypage-btn danger",onClick:O,disabled:g!=="계정삭제"||S,children:S?"삭제 중...":"계정 영구 삭제"}),e.jsx("button",{className:"mypage-btn ghost",onClick:()=>{P(!1),C("")},children:"취소"})]})]}):e.jsx("button",{className:"mypage-btn danger",onClick:()=>P(!0),style:{width:"100%"},children:"계정 삭제"})}),e.jsx("div",{className:"mypage-footer",children:e.jsx("button",{className:"mypage-btn danger",onClick:L,children:"로그아웃"})})]})]})})]})}export{se as default};
