import{f as N,r as a,j as e,P as y,H as k,L as p,m as B}from"./index-BqxgY0Ws.js";import{u as L}from"./useReviews-CCUfPomP.js";import{f as A}from"./formatDate-teZXCzp_.js";const C="_page_1r7s2_1",H="_backLink_1r7s2_5",R="_header_1r7s2_18",S="_subtitle_1r7s2_23",D="_writeArea_1r7s2_30",P="_writeBtn_1r7s2_35",T="_form_1r7s2_55",I="_formInput_1r7s2_65",F="_formTextarea_1r7s2_80",E="_formActions_1r7s2_97",$="_cancelBtn_1r7s2_103",q="_submitBtn_1r7s2_118",V="_reviewList_1r7s2_139",z="_reviewCard_1r7s2_147",G="_reviewHeader_1r7s2_159",J="_reviewAuthor_1r7s2_166",K="_reviewDate_1r7s2_172",M="_reviewContent_1r7s2_177",O="_loginPrompt_1r7s2_185",Q="_loginLink_1r7s2_200",U="_feedback_1r7s2_216",W="_success_1r7s2_225",X="_error_1r7s2_231",Y="_reviewHeaderRight_1r7s2_237",Z="_deleteBtn_1r7s2_243",ee="_empty_1r7s2_258",s={page:C,backLink:H,header:R,subtitle:S,writeArea:D,writeBtn:P,form:T,formInput:I,formTextarea:F,formActions:E,cancelBtn:$,submitBtn:q,reviewList:V,reviewCard:z,reviewHeader:G,reviewAuthor:J,reviewDate:K,reviewContent:M,loginPrompt:O,loginLink:Q,feedback:U,success:W,error:X,reviewHeaderRight:Y,deleteBtn:Z,empty:ee};function ne(){const{reviews:u,loading:v,createReview:x,deleteReview:f}=L(),{isLoggedIn:c,profile:o,user:r}=N(),[g,l]=a.useState(!1),[m,d]=a.useState(""),[h,w]=a.useState(!1),[_,n]=a.useState(null),j=async t=>{if(t.preventDefault(),!m.trim()||!c)return;w(!0),n(null);const{error:i}=await x({author_name:(o==null?void 0:o.display_name)||(r==null?void 0:r.email)||"익명",content:m.trim(),user_id:(r==null?void 0:r.id)||null});i?n({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(n({type:"success",message:"감상 후기가 등록되었습니다."}),d(""),l(!1)),w(!1),setTimeout(()=>n(null),3e3)},b=async t=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:i}=await f(t);n(i?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"후기가 삭제되었습니다."}),setTimeout(()=>n(null),3e3)};return e.jsxs(y,{children:[e.jsxs(k,{children:[e.jsx("title",{children:"감상 후기 — 好海"}),e.jsx("meta",{name:"description",content:"好海 이성헌 시인의 시와 노래에 대한 감상 후기"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(p,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"감상 후기"}),e.jsx("p",{className:s.subtitle,children:"시와 노래를 감상하신 소감을 나눠주세요"})]}),_&&e.jsx("div",{className:`${s.feedback} ${s[_.type]}`,children:_.message}),e.jsx("div",{className:s.writeArea,children:c?g?e.jsxs("form",{className:s.form,onSubmit:j,children:[e.jsx("textarea",{className:s.formTextarea,placeholder:"감상 후기를 작성해주세요...",value:m,onChange:t=>d(t.target.value),required:!0,rows:4}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>{l(!1),d("")},children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:h,children:h?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>l(!0),children:"후기 작성하기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 감상 후기를 남겨주세요"}),e.jsx(p,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),v?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):u.length>0?e.jsx("div",{className:s.reviewList,children:u.map((t,i)=>e.jsxs(B.article,{className:s.reviewCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:i*.05},children:[e.jsxs("div",{className:s.reviewHeader,children:[e.jsx("span",{className:s.reviewAuthor,children:t.author_name}),e.jsxs("div",{className:s.reviewHeaderRight,children:[e.jsx("span",{className:s.reviewDate,children:A(t.created_at)}),c&&(r==null?void 0:r.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>b(t.id),children:"삭제"})]})]}),e.jsx("p",{className:s.reviewContent,children:t.content})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 감상 후기가 없습니다. 첫 번째 후기를 남겨주세요!"})]})})]})}export{ne as default};
