import{f as v,r as i,j as e,P as B,H as L,L as x,m as C}from"./index-CUPqXICw.js";import{u as A}from"./useNews-CTXGq4CZ.js";import{f as T}from"./formatDate-teZXCzp_.js";const H="_page_1a3rb_1",S="_backLink_1a3rb_9",I="_header_1a3rb_35",D="_subtitle_1a3rb_45",P="_writeArea_1a3rb_59",R="_writeBtn_1a3rb_69",F="_form_1a3rb_109",q="_formInput_1a3rb_129",E="_formTextarea_1a3rb_159",$="_formActions_1a3rb_193",V="_cancelBtn_1a3rb_205",z="_submitBtn_1a3rb_235",G="_newsList_1a3rb_277",J="_newsCard_1a3rb_293",K="_newsHeader_1a3rb_317",M="_newsTitle_1a3rb_333",O="_newsHeaderRight_1a3rb_349",Q="_newsDate_1a3rb_363",U="_newsContent_1a3rb_373",W="_newsAuthor_1a3rb_391",X="_deleteBtn_1a3rb_403",Y="_loginPrompt_1a3rb_433",Z="_loginLink_1a3rb_463",ee="_feedback_1a3rb_495",se="_success_1a3rb_513",te="_error_1a3rb_525",ne="_empty_1a3rb_537",s={page:H,backLink:S,header:I,subtitle:D,writeArea:P,writeBtn:R,form:F,formInput:q,formTextarea:E,formActions:$,cancelBtn:V,submitBtn:z,newsList:G,newsCard:J,newsHeader:K,newsTitle:M,newsHeaderRight:O,newsDate:Q,newsContent:U,newsAuthor:W,deleteBtn:X,loginPrompt:Y,loginLink:Z,feedback:ee,success:se,error:te,empty:ne};function ce(){const{items:h,loading:f,createItem:g,deleteItem:j}=A(),{isLoggedIn:c,profile:o,user:n}=v(),[N,l]=i.useState(!1),[m,d]=i.useState(""),[_,u]=i.useState(""),[w,p]=i.useState(!1),[b,a]=i.useState(null),y=async t=>{if(t.preventDefault(),!m.trim()||!_.trim()||!c)return;p(!0),a(null);const{error:r}=await g({title:m.trim(),content:_.trim(),author_name:(o==null?void 0:o.display_name)||(n==null?void 0:n.email)||"익명",user_id:(n==null?void 0:n.id)||null});r?a({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(a({type:"success",message:"소식이 등록되었습니다."}),d(""),u(""),l(!1)),p(!1),setTimeout(()=>a(null),3e3)},k=async t=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:r}=await j(t);a(r?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>a(null),3e3)};return e.jsxs(B,{children:[e.jsxs(L,{children:[e.jsx("title",{children:"소식통 — 好海"}),e.jsx("meta",{name:"description",content:"好海 소식통 — 소식과 이야기를 전해주세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(x,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"소식통"}),e.jsx("p",{className:s.subtitle,children:"소식과 이야기를 전해주세요"})]}),b&&e.jsx("div",{className:`${s.feedback} ${s[b.type]}`,children:b.message}),e.jsx("div",{className:s.writeArea,children:c?N?e.jsxs("form",{className:s.form,onSubmit:y,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>d(t.target.value),required:!0}),e.jsx("textarea",{className:s.formTextarea,placeholder:"내용을 작성해주세요...",value:_,onChange:t=>u(t.target.value),required:!0,rows:5}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>{l(!1),d(""),u("")},children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:w,children:w?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>l(!0),children:"소식 작성하기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 소식을 전해주세요"}),e.jsx(x,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),f?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):h.length>0?e.jsx("div",{className:s.newsList,children:h.map((t,r)=>e.jsxs(C.article,{className:s.newsCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:r*.05},children:[e.jsxs("div",{className:s.newsHeader,children:[e.jsx("h3",{className:s.newsTitle,children:t.title}),e.jsxs("div",{className:s.newsHeaderRight,children:[e.jsx("span",{className:s.newsDate,children:T(t.created_at)}),c&&(n==null?void 0:n.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>k(t.id),children:"삭제"})]})]}),e.jsx("p",{className:s.newsContent,children:t.content}),e.jsx("span",{className:s.newsAuthor,children:t.author_name})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 소식이 없습니다. 첫 번째 소식을 전해주세요!"})]})})]})}export{ce as default};
