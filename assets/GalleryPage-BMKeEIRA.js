import{f as G,r as l,j as e,P as M,H as R,L as D,m as W}from"./index-CNhTrOr2.js";import{u as E,a as $}from"./useGallery-BLrXlY9x.js";import{f as H}from"./formatDate-teZXCzp_.js";const U="_page_1rxiv_1",q="_backLink_1rxiv_9",O="_header_1rxiv_35",V="_subtitle_1rxiv_45",X="_writeArea_1rxiv_59",Z="_writeBtn_1rxiv_69",J="_form_1rxiv_109",K="_formInput_1rxiv_129",Q="_dropzone_1rxiv_159",Y="_dragging_1rxiv_189",ee="_dropzoneText_1rxiv_199",se="_previewImg_1rxiv_221",re="_formTextarea_1rxiv_235",te="_formActions_1rxiv_269",ae="_cancelBtn_1rxiv_281",le="_submitBtn_1rxiv_311",ne="_galleryGrid_1rxiv_353",ie="_galleryCard_1rxiv_369",ce="_galleryImageWrap_1rxiv_393",oe="_galleryImage_1rxiv_393",me="_galleryInfo_1rxiv_427",de="_galleryTitle_1rxiv_435",ge="_galleryDesc_1rxiv_451",_e="_galleryMeta_1rxiv_467",ue="_galleryAuthor_1rxiv_483",xe="_galleryDate_1rxiv_491",pe="_deleteBtn_1rxiv_499",ye="_loginPrompt_1rxiv_531",he="_loginLink_1rxiv_561",fe="_feedback_1rxiv_593",ve="_success_1rxiv_611",je="_error_1rxiv_623",Ne="_empty_1rxiv_635",r={page:U,backLink:q,header:O,subtitle:V,writeArea:X,writeBtn:Z,form:J,formInput:K,dropzone:Q,dragging:Y,dropzoneText:ee,previewImg:se,formTextarea:re,formActions:te,cancelBtn:ae,submitBtn:le,galleryGrid:ne,galleryCard:ie,galleryImageWrap:ce,galleryImage:oe,galleryInfo:me,galleryTitle:de,galleryDesc:ge,galleryMeta:_e,galleryAuthor:ue,galleryDate:xe,deleteBtn:pe,loginPrompt:ye,loginLink:he,feedback:fe,success:ve,error:je,empty:Ne},be=5*1024*1024;function De(){const{items:f,loading:T,createItem:B,deleteItem:A}=E(),{isLoggedIn:c,profile:o,user:i}=G(),[L,m]=l.useState(!1),[d,g]=l.useState(""),[v,_]=l.useState(""),[u,x]=l.useState(null),[j,p]=l.useState(null),[S,y]=l.useState(!1),[N,b]=l.useState(!1),[h,a]=l.useState(null),I=l.useRef(null),w=s=>{if(s.size>be){a({type:"error",message:"파일 크기는 5MB 이하만 가능합니다."}),setTimeout(()=>a(null),3e3);return}if(!s.type.startsWith("image/")){a({type:"error",message:"이미지 파일만 업로드 가능합니다."}),setTimeout(()=>a(null),3e3);return}x(s);const t=new FileReader;t.onload=n=>{var k;return p((k=n.target)==null?void 0:k.result)},t.readAsDataURL(s)},C=s=>{s.preventDefault(),y(!1);const t=s.dataTransfer.files[0];t&&w(t)},z=async s=>{if(s.preventDefault(),!(!d.trim()||!u||!c||!i)){b(!0),a(null);try{const t=await $(u,i.id),{error:n}=await B({title:d.trim(),image_url:t,description:v.trim(),author_name:(o==null?void 0:o.display_name)||i.email||"익명",user_id:i.id});n?a({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(a({type:"success",message:"갤러리에 등록되었습니다."}),g(""),_(""),x(null),p(null),m(!1))}catch{a({type:"error",message:"이미지 업로드에 실패했습니다."})}b(!1),setTimeout(()=>a(null),3e3)}},F=async(s,t)=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:n}=await A(s,t);a(n?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>a(null),3e3)},P=()=>{m(!1),g(""),_(""),x(null),p(null)};return e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx("title",{children:"갤러리 — 好海"}),e.jsx("meta",{name:"description",content:"好海 갤러리 — 이미지와 함께 추억을 공유하세요"})]}),e.jsx("div",{className:r.page,children:e.jsxs("div",{className:"container",children:[e.jsx(D,{to:"/community",className:r.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:r.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"갤러리"}),e.jsx("p",{className:r.subtitle,children:"이미지와 함께 추억을 공유하세요"})]}),h&&e.jsx("div",{className:`${r.feedback} ${r[h.type]}`,children:h.message}),e.jsx("div",{className:r.writeArea,children:c?L?e.jsxs("form",{className:r.form,onSubmit:z,children:[e.jsx("input",{className:r.formInput,type:"text",placeholder:"제목",value:d,onChange:s=>g(s.target.value),required:!0}),e.jsxs("div",{className:`${r.dropzone} ${S?r.dragging:""}`,onDragOver:s=>{s.preventDefault(),y(!0)},onDragLeave:()=>y(!1),onDrop:C,onClick:()=>{var s;return(s=I.current)==null?void 0:s.click()},children:[j?e.jsx("img",{src:j,alt:"미리보기",className:r.previewImg}):e.jsxs("p",{className:r.dropzoneText,children:["이미지를 드래그하거나 클릭하여 업로드",e.jsx("br",{}),e.jsx("small",{children:"(최대 5MB)"})]}),e.jsx("input",{ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:s=>{var n;const t=(n=s.target.files)==null?void 0:n[0];t&&w(t)}})]}),e.jsx("textarea",{className:r.formTextarea,placeholder:"설명 (선택사항)",value:v,onChange:s=>_(s.target.value),rows:3}),e.jsxs("div",{className:r.formActions,children:[e.jsx("button",{type:"button",className:r.cancelBtn,onClick:P,children:"취소"}),e.jsx("button",{type:"submit",className:r.submitBtn,disabled:N||!u,children:N?"등록 중...":"등록"})]})]}):e.jsx("button",{className:r.writeBtn,onClick:()=>m(!0),children:"사진 올리기"}):e.jsxs("div",{className:r.loginPrompt,children:[e.jsx("p",{children:"로그인 후 갤러리에 사진을 올려주세요"}),e.jsx(D,{to:"/login",className:r.loginLink,children:"로그인하기"})]})}),T?e.jsx("p",{className:r.empty,children:"불러오는 중..."}):f.length>0?e.jsx("div",{className:r.galleryGrid,children:f.map((s,t)=>e.jsxs(W.article,{className:r.galleryCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:t*.05},children:[e.jsx("div",{className:r.galleryImageWrap,children:e.jsx("img",{src:s.image_url,alt:s.title,className:r.galleryImage})}),e.jsxs("div",{className:r.galleryInfo,children:[e.jsx("h3",{className:r.galleryTitle,children:s.title}),s.description&&e.jsx("p",{className:r.galleryDesc,children:s.description}),e.jsxs("div",{className:r.galleryMeta,children:[e.jsx("span",{className:r.galleryAuthor,children:s.author_name}),e.jsx("span",{className:r.galleryDate,children:H(s.created_at)})]}),c&&(i==null?void 0:i.id)===s.user_id&&e.jsx("button",{className:r.deleteBtn,onClick:()=>F(s.id,s.image_url),children:"삭제"})]})]},s.id))}):e.jsx("p",{className:r.empty,children:"아직 갤러리에 사진이 없습니다. 첫 번째 사진을 올려주세요!"})]})})]})}export{De as default};
