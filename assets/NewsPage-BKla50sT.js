import{f as v,r,j as e,P as B,H as L,L as p,m as C}from"./index-BvDDahVw.js";import{u as A}from"./useNews-CAjAfKzc.js";import{f as T}from"./formatDate-teZXCzp_.js";const H="_page_1ixuj_1",S="_backLink_1ixuj_5",I="_header_1ixuj_18",D="_subtitle_1ixuj_23",P="_writeArea_1ixuj_30",R="_writeBtn_1ixuj_35",F="_form_1ixuj_55",q="_formInput_1ixuj_65",E="_formTextarea_1ixuj_80",$="_formActions_1ixuj_97",V="_cancelBtn_1ixuj_103",z="_submitBtn_1ixuj_118",G="_newsList_1ixuj_139",J="_newsCard_1ixuj_147",K="_newsHeader_1ixuj_159",M="_newsTitle_1ixuj_167",O="_newsHeaderRight_1ixuj_175",Q="_newsDate_1ixuj_182",U="_newsContent_1ixuj_187",W="_newsAuthor_1ixuj_196",X="_deleteBtn_1ixuj_202",Y="_loginPrompt_1ixuj_217",Z="_loginLink_1ixuj_232",ee="_feedback_1ixuj_248",se="_success_1ixuj_257",te="_error_1ixuj_263",ne="_empty_1ixuj_269",s={page:H,backLink:S,header:I,subtitle:D,writeArea:P,writeBtn:R,form:F,formInput:q,formTextarea:E,formActions:$,cancelBtn:V,submitBtn:z,newsList:G,newsCard:J,newsHeader:K,newsTitle:M,newsHeaderRight:O,newsDate:Q,newsContent:U,newsAuthor:W,deleteBtn:X,loginPrompt:Y,loginLink:Z,feedback:ee,success:se,error:te,empty:ne};function ce(){const{items:j,loading:f,createItem:g,deleteItem:b}=A(),{isLoggedIn:c,profile:o,user:n}=v(),[N,l]=r.useState(!1),[m,u]=r.useState(""),[d,_]=r.useState(""),[h,w]=r.useState(!1),[x,a]=r.useState(null),y=async t=>{if(t.preventDefault(),!m.trim()||!d.trim()||!c)return;w(!0),a(null);const{error:i}=await g({title:m.trim(),content:d.trim(),author_name:(o==null?void 0:o.display_name)||(n==null?void 0:n.email)||"익명",user_id:(n==null?void 0:n.id)||null});i?a({type:"error",message:"등록에 실패했습니다. 다시 시도해주세요."}):(a({type:"success",message:"소식이 등록되었습니다."}),u(""),_(""),l(!1)),w(!1),setTimeout(()=>a(null),3e3)},k=async t=>{if(!window.confirm("정말 삭제하시겠습니까?"))return;const{error:i}=await b(t);a(i?{type:"error",message:"삭제에 실패했습니다."}:{type:"success",message:"삭제되었습니다."}),setTimeout(()=>a(null),3e3)};return e.jsxs(B,{children:[e.jsxs(L,{children:[e.jsx("title",{children:"소식통 — 好海"}),e.jsx("meta",{name:"description",content:"好海 소식통 — 소식과 이야기를 전해주세요"})]}),e.jsx("div",{className:s.page,children:e.jsxs("div",{className:"container",children:[e.jsx(p,{to:"/community",className:s.backLink,children:"← 커뮤니티"}),e.jsxs("div",{className:s.header,children:[e.jsx("h1",{className:"section-title",style:{display:"inline-block"},children:"소식통"}),e.jsx("p",{className:s.subtitle,children:"소식과 이야기를 전해주세요"})]}),x&&e.jsx("div",{className:`${s.feedback} ${s[x.type]}`,children:x.message}),e.jsx("div",{className:s.writeArea,children:c?N?e.jsxs("form",{className:s.form,onSubmit:y,children:[e.jsx("input",{className:s.formInput,type:"text",placeholder:"제목",value:m,onChange:t=>u(t.target.value),required:!0}),e.jsx("textarea",{className:s.formTextarea,placeholder:"내용을 작성해주세요...",value:d,onChange:t=>_(t.target.value),required:!0,rows:5}),e.jsxs("div",{className:s.formActions,children:[e.jsx("button",{type:"button",className:s.cancelBtn,onClick:()=>{l(!1),u(""),_("")},children:"취소"}),e.jsx("button",{type:"submit",className:s.submitBtn,disabled:h,children:h?"등록 중...":"등록"})]})]}):e.jsx("button",{className:s.writeBtn,onClick:()=>l(!0),children:"소식 작성하기"}):e.jsxs("div",{className:s.loginPrompt,children:[e.jsx("p",{children:"로그인 후 소식을 전해주세요"}),e.jsx(p,{to:"/login",className:s.loginLink,children:"로그인하기"})]})}),f?e.jsx("p",{className:s.empty,children:"불러오는 중..."}):j.length>0?e.jsx("div",{className:s.newsList,children:j.map((t,i)=>e.jsxs(C.article,{className:s.newsCard,initial:{opacity:0,y:20},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-20px"},transition:{duration:.4,delay:i*.05},children:[e.jsxs("div",{className:s.newsHeader,children:[e.jsx("h3",{className:s.newsTitle,children:t.title}),e.jsxs("div",{className:s.newsHeaderRight,children:[e.jsx("span",{className:s.newsDate,children:T(t.created_at)}),c&&(n==null?void 0:n.id)===t.user_id&&e.jsx("button",{className:s.deleteBtn,onClick:()=>k(t.id),children:"삭제"})]})]}),e.jsx("p",{className:s.newsContent,children:t.content}),e.jsx("span",{className:s.newsAuthor,children:t.author_name})]},t.id))}):e.jsx("p",{className:s.empty,children:"아직 소식이 없습니다. 첫 번째 소식을 전해주세요!"})]})})]})}export{ce as default};
