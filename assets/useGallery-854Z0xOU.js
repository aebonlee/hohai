import{r as o,s as a}from"./index-CUPqXICw.js";async function p(l,c){const i=l.name.split(".").pop()||"jpg",n=Date.now(),e=Math.random().toString(36).substring(2,8),m=`${c}/${n}_${e}.${i}`,{error:d}=await a.storage.from("gallery").upload(m,l);if(d)throw d;const{data:t}=a.storage.from("gallery").getPublicUrl(m);return t.publicUrl}function h(){const[l,c]=o.useState([]),[i,n]=o.useState(!0),e=o.useCallback(async()=>{n(!0);const{data:t}=await a.from("hohai_gallery").select("*").eq("is_published",!0).order("created_at",{ascending:!1});c(t||[]),n(!1)},[]);return o.useEffect(()=>{e()},[e]),{items:l,loading:i,createItem:async t=>{const{error:r}=await a.from("hohai_gallery").insert({...t,is_published:!0});return r||await e(),{error:r}},deleteItem:async(t,r)=>{try{const u=new URL(r).pathname.split("/gallery/");u[1]&&await a.storage.from("gallery").remove([decodeURIComponent(u[1])])}catch{}const{error:s}=await a.from("hohai_gallery").delete().eq("id",t);return s||await e(),{error:s}},refetch:e}}function y(){const[l,c]=o.useState([]),[i,n]=o.useState(!0),e=o.useCallback(async()=>{n(!0);const{data:t}=await a.from("hohai_gallery").select("*").order("created_at",{ascending:!1});c(t||[]),n(!1)},[]);return o.useEffect(()=>{e()},[e]),{items:l,loading:i,updateItem:async(t,r)=>{const{error:s}=await a.from("hohai_gallery").update(r).eq("id",t);return s||await e(),{error:s}},deleteItem:async(t,r)=>{try{const u=new URL(r).pathname.split("/gallery/");u[1]&&await a.storage.from("gallery").remove([decodeURIComponent(u[1])])}catch{}const{error:s}=await a.from("hohai_gallery").delete().eq("id",t);return s||await e(),{error:s}},refetch:e}}export{p as a,y as b,h as u};
