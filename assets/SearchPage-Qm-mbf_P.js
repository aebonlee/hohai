import{r as i,s as g,u as _,j as e,P as f,H as j,c as I}from"./index-CE2Wc_m1.js";import{S as y}from"./SongCard-DuGO2cX-.js";import"./LikeButton-DVnaNU1Y.js";import"./useViewCount-ClEcGSnf.js";function b(l){const[d,u]=i.useState({poems:[],songs:[]}),[c,h]=i.useState(!1),r=i.useRef(0),o=i.useCallback(async m=>{const p=m.trim();if(!p){u({poems:[],songs:[]}),h(!1);return}const a=++r.current;h(!0);const s=`%${p}%`,[n,x]=await Promise.all([g.from("hohai_poems").select("*").eq("is_published",!0).or(`title.ilike.${s},content.ilike.${s}`).order("created_at",{ascending:!1}).limit(20),g.from("hohai_songs").select("*").eq("is_published",!0).or(`title.ilike.${s},lyrics.ilike.${s}`).order("created_at",{ascending:!1}).limit(20)]);a===r.current&&(u({poems:n.data||[],songs:x.data||[]}),h(!1))},[]);return i.useEffect(()=>{const m=setTimeout(()=>o(l),300);return()=>clearTimeout(m)},[l,o]),{results:d,loading:c}}const N="_page_ephbm_1",v="_searchHeader_ephbm_6",k="_searchInput_ephbm_10",S="_searchInputWrapper_ephbm_29",P="_searchIcon_ephbm_35",T="_resultInfo_ephbm_44",C="_sectionTitle_ephbm_51",L="_poemGrid_ephbm_61",q="_songList_ephbm_68",H="_empty_ephbm_75",t={page:N,searchHeader:v,searchInput:k,searchInputWrapper:S,searchIcon:P,resultInfo:T,sectionTitle:C,poemGrid:L,songList:q,empty:H};function G(){const[l,d]=_(),u=l.get("q")||"",[c,h]=i.useState(u),{results:r,loading:o}=b(c);i.useEffect(()=>{const s=l.get("q")||"";s!==c&&h(s)},[l]);const m=s=>{const n=s.target.value;h(n),n.trim()?d({q:n},{replace:!0}):d({},{replace:!0})},p=r.poems.length+r.songs.length,a=c.trim().length>0;return e.jsxs(f,{children:[e.jsx(j,{children:e.jsx("title",{children:a?`"${c}" 검색 결과 — 好海`:"검색 — 好海"})}),e.jsx("div",{className:t.page,children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:t.searchHeader,children:[e.jsx("h1",{className:"section-title",style:{textAlign:"center",marginBottom:"24px"},children:"검색"}),e.jsxs("div",{className:t.searchInputWrapper,children:[e.jsxs("svg",{className:t.searchIcon,width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{className:t.searchInput,type:"text",value:c,onChange:m,placeholder:"시 제목, 내용, 노래 가사로 검색...",autoFocus:!0})]})]}),o&&a&&e.jsx("p",{className:t.resultInfo,children:"검색 중..."}),!o&&a&&e.jsxs("p",{className:t.resultInfo,children:['"',c,'" 검색 결과 ',p,"건"]}),!o&&a&&r.poems.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:t.sectionTitle,children:["시 (",r.poems.length,")"]}),e.jsx("div",{className:t.poemGrid,children:r.poems.map((s,n)=>e.jsx(I,{poem:s,index:n},s.id))})]}),!o&&a&&r.songs.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("h2",{className:t.sectionTitle,children:["노래 (",r.songs.length,")"]}),e.jsx("div",{className:t.songList,children:r.songs.map((s,n)=>e.jsx(y,{song:s,index:n},s.id))})]}),!o&&a&&p===0&&e.jsx("p",{className:t.empty,children:"검색 결과가 없습니다. 다른 키워드로 검색해보세요."}),!a&&e.jsx("p",{className:t.empty,children:"시 제목, 내용, 노래 가사를 검색할 수 있습니다."})]})})]})}export{G as default};
