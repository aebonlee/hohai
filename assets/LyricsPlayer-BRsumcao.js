import{o as R,r as o,f as H,q as M,j as t,A as W,m as r,l as D,t as C}from"./index-BvDDahVw.js";import{r as q,L as F}from"./LyricsEffects-CccY5AI3.js";import{u as $,A as K,c as Y}from"./SongCard-uqK6MS1_.js";import{u as G,a as U,L as z,S as J}from"./LikeButton-CFU3rHrt.js";const Q="_overlay_1phta_11",V="_closeBtn_1phta_30",X="_content_1phta_58",Z="_playerPanel_1phta_71",O="_playerWrapper_1phta_79",tt="_secondaryPlayer_1phta_96",et="_playlistNav_1phta_111",at="_navBtn_1phta_122",st="_navPosition_1phta_144",nt="_songMeta_1phta_153",ot="_songTitle_1phta_159",it="_songCounts_1phta_167",lt="_songCountHeart_1phta_173",ct="_songCountStar_1phta_179",rt="_songActions_1phta_185",dt="_songTags_1phta_195",ut="_songTag_1phta_195",yt="_lyricsPanel_1phta_212",pt="_lyricsHeader_1phta_224",ht="_lyricsBody_1phta_236",mt="_noLyrics_1phta_266",e={overlay:Q,closeBtn:V,content:X,playerPanel:Z,playerWrapper:O,secondaryPlayer:tt,playlistNav:et,navBtn:at,navPosition:st,songMeta:nt,songTitle:ot,songCounts:it,songCountHeart:lt,songCountStar:ct,songActions:rt,songTags:dt,songTag:ut,lyricsPanel:yt,lyricsHeader:pt,lyricsBody:ht,noLyrics:mt};function jt({song:a,isOpen:i,onClose:l}){const{onSongEnd:T,playlist:d,currentIndex:v,hasNext:E,hasPrev:B,next:L,prev:k}=R(),f=o.useRef(null),u=o.useRef(null),y=o.useRef(null),{user:p}=H(),{count:h}=G("song",a.id,p==null?void 0:p.id),m=U(a.id),_=!!a.youtube_id,g=!!a.suno_url,A=!!a.lyrics,S=a.tags&&a.tags.length>0,I=d!==null&&v>=0,j=M(a.tags),c=D[j],b=`lp-yt-${o.useId().replace(/:/g,"")}`;$({containerId:b,videoId:a.youtube_id||null,autoplay:!1,enabled:i&&_,onEnd:()=>{T()}});const x=o.useCallback(s=>{if(s.key==="Escape"){l();return}if(s.key==="Tab"&&y.current){const n=y.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"]), iframe');if(n.length===0)return;const N=n[0],P=n[n.length-1];s.shiftKey?document.activeElement===N&&(s.preventDefault(),P.focus()):document.activeElement===P&&(s.preventDefault(),N.focus())}},[l]);o.useEffect(()=>{if(!i)return;u.current=document.activeElement;const s=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",document.body.style.paddingRight=`${s}px`,requestAnimationFrame(()=>{var n;return(n=f.current)==null?void 0:n.focus()}),document.addEventListener("keydown",x),()=>{document.body.style.overflow="",document.body.style.paddingRight="",document.removeEventListener("keydown",x),u.current instanceof HTMLElement&&u.current.focus()}},[i,x]);const w=s=>{s.target===s.currentTarget&&l()};return q.createPortal(t.jsx(W,{children:i&&t.jsxs(r.div,{ref:y,className:e.overlay,role:"dialog","aria-modal":"true","aria-label":`${a.title} — 가사 플레이어`,onClick:w,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.4},style:{"--mood-c1":c.c1,"--mood-c2":c.c2,"--mood-c3":c.c3,"--mood-c4":c.c4},children:[t.jsx(F,{mood:j,isActive:i}),t.jsx(r.button,{ref:f,className:e.closeBtn,onClick:l,"aria-label":"닫기",title:"가사 플레이어를 닫습니다 (ESC키로도 닫을 수 있습니다)",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3,delay:.3},children:"✕"}),t.jsxs("div",{className:e.content,children:[t.jsxs(r.div,{className:e.playerPanel,initial:{opacity:0,x:-40},animate:{opacity:1,x:0},exit:{opacity:0,x:-40},transition:{duration:.5,delay:.15},children:[t.jsx("div",{className:e.playerWrapper,children:_?t.jsx("div",{id:b,style:{width:"100%",height:"100%"}}):g?t.jsx("iframe",{src:C(a.suno_url),title:a.title,allow:"autoplay"}):null}),_&&g&&t.jsx("div",{className:e.secondaryPlayer,children:t.jsx("iframe",{src:C(a.suno_url),title:a.title,allow:"autoplay"})}),I&&d&&t.jsxs("div",{className:e.playlistNav,children:[t.jsx("button",{className:e.navBtn,onClick:k,disabled:!B,"aria-label":"이전 곡",title:"이전 곡",children:"⏮ 이전"}),t.jsxs("span",{className:e.navPosition,children:[v+1," / ",d.length]}),t.jsx("button",{className:e.navBtn,onClick:L,disabled:!E,"aria-label":"다음 곡",title:"다음 곡",children:"다음 ⏭"})]}),t.jsxs("div",{className:e.songMeta,children:[t.jsx("h2",{className:e.songTitle,children:a.title}),(h>0||m>0)&&t.jsxs("div",{className:e.songCounts,children:[h>0&&t.jsxs("span",{className:e.songCountHeart,children:["♥ ",h]}),m>0&&t.jsxs("span",{className:e.songCountStar,children:["★ ",m]})]}),t.jsxs("div",{className:e.songActions,children:[t.jsx(z,{targetType:"song",targetId:a.id}),t.jsx(K,{songId:a.id}),t.jsx(J,{title:a.title,text:a.title})]}),S&&t.jsx("div",{className:e.songTags,children:a.tags.map(s=>t.jsxs("span",{className:e.songTag,children:["#",s]},s))})]})]}),t.jsxs(r.div,{className:e.lyricsPanel,initial:{opacity:0,x:40},animate:{opacity:1,x:0},exit:{opacity:0,x:40},transition:{duration:.5,delay:.25},children:[t.jsx("div",{className:e.lyricsHeader,children:"가사"}),A?t.jsx("div",{className:e.lyricsBody,children:Y(a.lyrics)}):t.jsx("div",{className:e.noLyrics,children:"가사가 없습니다"})]})]})]})}),document.body)}export{jt as L};
