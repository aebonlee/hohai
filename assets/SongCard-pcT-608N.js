import{r as a,f as O,w as z,a as U,j as e,o as G,m as J,t as $}from"./index-Dq0PCZmx.js";import{u as Q,a as X,L as Z,S as ee}from"./LikeButton-CZTR27Kt.js";import{a as te}from"./useViewCount-DjxGBIFS.js";let L=!1,E=!1;const I=[];function se(){return E&&window.YT?Promise.resolve():new Promise(t=>{if(I.push(t),L)return;L=!0;const l=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{E=!0,L=!1,l==null||l(),I.forEach(i=>i()),I.length=0},document.querySelector('script[src*="youtube.com/iframe_api"]')){window.YT&&window.YT.Player&&(E=!0,L=!1,I.forEach(i=>i()),I.length=0);return}const r=document.createElement("script");r.src="https://www.youtube.com/iframe_api",r.async=!0,document.head.appendChild(r)})}function ne({containerId:t,videoId:l,autoplay:r,enabled:i,onEnd:k,onPlay:N}){const u=a.useRef(null),d=a.useRef(k),o=a.useRef(N);d.current=k,o.current=N;const m=a.useCallback(()=>{var _;try{(_=u.current)==null||_.destroy()}catch{}u.current=null},[]);return a.useEffect(()=>{if(!i||!l){m();return}let _=!1;return se().then(()=>{_||!window.YT||(m(),!document.getElementById(t))||(u.current=new window.YT.Player(t,{videoId:l,playerVars:{autoplay:r?1:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1},events:{onStateChange:p=>{var w,b;p.data===0&&((w=d.current)==null||w.call(d)),p.data===1&&((b=o.current)==null||b.call(o))}}}))}),()=>{_=!0,m()}},[i,l,t,r,m]),{destroyPlayer:m}}const ae="_wrapper_mq9yh_1",ie="_favBtn_mq9yh_17",ce="_star_mq9yh_55",le="_favActive_mq9yh_85",re="_moreBtn_mq9yh_107",oe="_dropdown_mq9yh_149",ue="_dropdownHeader_mq9yh_175",de="_empty_mq9yh_195",me="_dropdownItem_mq9yh_207",_e="_included_mq9yh_245",pe="_itemCheck_mq9yh_253",ye="_itemName_mq9yh_265",he="_itemCount_mq9yh_279",fe="_createBtn_mq9yh_291",we="_createForm_mq9yh_329",xe="_createInput_mq9yh_343",ve="_createConfirm_mq9yh_375",c={wrapper:ae,favBtn:ie,star:ce,favActive:le,moreBtn:re,dropdown:oe,dropdownHeader:ue,empty:de,dropdownItem:me,included:_e,itemCheck:pe,itemName:ye,itemCount:he,createBtn:fe,createForm:we,createInput:xe,createConfirm:ve},V="즐겨찾기";function je({songId:t}){const{isLoggedIn:l,user:r}=O(),{playlists:i,createPlaylist:k,addSongToPlaylist:N,removeSongFromPlaylist:u}=z(),d=U(),[o,m]=a.useState(!1),[_,f]=a.useState(!1),[p,w]=a.useState(""),[b,P]=a.useState(!1),g=a.useRef(null),x=i.find(n=>n.name===V),y=x?x.song_ids.includes(t):!1;a.useEffect(()=>{if(!o)return;const n=j=>{g.current&&!g.current.contains(j.target)&&(m(!1),f(!1))};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[o]);const S=async n=>{if(n.stopPropagation(),!l){d("/login");return}if(!b){P(!0);try{x?y?await u(x.id,t):await N(x.id,t):await k({user_id:r.id,name:V,song_ids:[t]})}finally{P(!1)}}},T=n=>{if(n.stopPropagation(),!l){d("/login");return}m(!o),f(!1)},q=async n=>{await N(n,t)},C=async n=>{await u(n,t)},v=async()=>{!p.trim()||!r||(await k({user_id:r.id,name:p.trim(),song_ids:[t]}),w(""),f(!1))},B=n=>{n.key==="Enter"&&v(),n.key==="Escape"&&f(!1)};return e.jsxs("div",{className:c.wrapper,ref:g,children:[e.jsxs("button",{className:`${c.favBtn} ${y?c.favActive:""}`,onClick:S,disabled:b,"aria-label":y?"즐겨찾기에서 제거":"즐겨찾기에 추가",title:y?"즐겨찾기에서 이 곡을 제거합니다":"이 곡을 즐겨찾기에 추가합니다",children:[e.jsx("span",{className:c.star,children:y?"★":"☆"}),"즐겨찾기"]}),e.jsx("button",{className:c.moreBtn,onClick:T,"aria-label":"다른 재생목록에 추가",title:"다른 재생목록을 선택하여 곡을 추가합니다",children:"▾"}),o&&e.jsxs("div",{className:c.dropdown,children:[e.jsx("div",{className:c.dropdownHeader,children:"재생목록에 추가"}),i.length===0&&!_&&e.jsx("div",{className:c.empty,children:"재생목록이 없습니다"}),i.map(n=>{const j=n.song_ids.includes(t);return e.jsxs("button",{className:`${c.dropdownItem} ${j?c.included:""}`,onClick:()=>j?C(n.id):q(n.id),children:[e.jsx("span",{className:c.itemCheck,children:j?"✓":""}),e.jsx("span",{className:c.itemName,children:n.name}),e.jsxs("span",{className:c.itemCount,children:[n.song_ids.length,"곡"]})]},n.id)}),_?e.jsxs("div",{className:c.createForm,children:[e.jsx("input",{className:c.createInput,type:"text",value:p,onChange:n=>w(n.target.value),onKeyDown:B,placeholder:"재생목록 이름",autoFocus:!0,maxLength:50}),e.jsx("button",{className:c.createConfirm,onClick:v,disabled:!p.trim(),children:"확인"})]}):e.jsx("button",{className:c.createBtn,onClick:()=>f(!0),children:"+ 새 재생목록 만들기"})]})]})}function ke(t){return t.split(`
`).filter(l=>!/^\s*\[.*\]\s*$/.test(l)).join(`
`).replace(/\n{3,}/g,`

`).trim()}const Ne="_card_pwkl9_1",be="_thumbnail_pwkl9_13",ge="_thumbnailImg_pwkl9_22",Ce="_playBtn_pwkl9_33",Pe="_sourceBadge_pwkl9_64",Be="_ytContainer_pwkl9_84",Ie="_sunoPlaceholder_pwkl9_90",Se="_sunoLabel_pwkl9_109",qe="_sunoPlayIcon_pwkl9_115",Le="_sunoIframe_pwkl9_146",Te="_sunoSection_pwkl9_154",Ae="_sunoBtn_pwkl9_164",Ee="_playlistNav_pwkl9_185",Re="_navBtn_pwkl9_195",Fe="_navPosition_pwkl9_215",Ye="_info_pwkl9_223",$e="_statsRow_pwkl9_227",Ve="_counts_pwkl9_236",Oe="_countItem_pwkl9_242",He="_actions_pwkl9_256",De="_title_pwkl9_262",Me="_description_pwkl9_270",We="_tags_pwkl9_281",Ke="_tag_pwkl9_281",ze="_lyricsActions_pwkl9_297",Ue="_lyricsToggle_pwkl9_305",Ge="_lyricsPlayerBtn_pwkl9_322",Je="_lyrics_pwkl9_297",s={card:Ne,thumbnail:be,thumbnailImg:ge,playBtn:Ce,sourceBadge:Pe,ytContainer:Be,sunoPlaceholder:Ie,sunoLabel:Se,sunoPlayIcon:qe,sunoIframe:Le,sunoSection:Te,sunoBtn:Ae,playlistNav:Ee,navBtn:Re,navPosition:Fe,info:Ye,statsRow:$e,counts:Ve,countItem:Oe,actions:He,title:De,description:Me,tags:We,tag:Ke,lyricsActions:ze,lyricsToggle:Ue,lyricsPlayerBtn:Ge,lyrics:Je};function st({song:t,index:l=0,contextPlaylist:r}){const{currentId:i,play:k,onSongEnd:N,playlist:u,currentIndex:d,hasNext:o,hasPrev:m,next:_,prev:f,setPlaylist:p,autoPlayIntent:w,openLyricsPlayer:b}=G(),[P,g]=a.useState(!1),[x,y]=a.useState(!1),[S,T]=a.useState(!1),q=a.useRef(null),C=!!t.youtube_id,v=!!t.suno_url,{user:B}=O(),{count:n}=Q("song",t.id,B==null?void 0:B.id),j=X(t.id),R=te("hohai_songs"),H=!!t.lyrics,D=t.tags&&t.tags.length>0,M=u!==null&&i===t.id&&d>=0,F=`yt-${a.useId().replace(/:/g,"")}`;a.useEffect(()=>{i&&i!==t.id&&(g(!1),y(!1))},[i,t.id]),a.useEffect(()=>{i===t.id&&w&&(C?g(!0):v&&y(!0),requestAnimationFrame(()=>{var h;(h=q.current)==null||h.scrollIntoView({behavior:"smooth",block:"center"})}))},[i,t.id,w,C,v]),ne({containerId:F,videoId:t.youtube_id||null,autoplay:!0,enabled:P&&C,onEnd:()=>{N()}});const A=h=>{r&&r.length>0&&p(r),k(h)},W=()=>{R(t.id),A(t.id),g(!0)},Y=()=>{R(t.id),A(t.id),y(!0)},K=()=>{A(t.id),b()};return e.jsxs(J.article,{ref:q,className:s.card,initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-40px"},transition:{duration:.5,delay:l*.1},children:[e.jsx("div",{className:s.thumbnail,children:C?P?e.jsx("div",{id:F,className:s.ytContainer}):e.jsxs(e.Fragment,{children:[e.jsx("img",{className:s.thumbnailImg,src:`https://img.youtube.com/vi/${t.youtube_id}/hqdefault.jpg`,alt:t.title,loading:"lazy"}),e.jsx("button",{className:s.playBtn,onClick:W,"aria-label":`${t.title} 재생`,title:"클릭하면 노래가 재생됩니다"}),v&&e.jsx("span",{className:s.sourceBadge,children:"YouTube"})]}):v?x?e.jsx("iframe",{className:s.sunoIframe,src:$(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("div",{className:s.sunoPlaceholder,onClick:Y,title:"클릭하면 노래가 재생됩니다",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),e.jsx("span",{className:s.sunoLabel,children:"음원 재생"}),e.jsx("div",{className:s.sunoPlayIcon})]}):null}),C&&v&&e.jsx("div",{className:s.sunoSection,children:x?e.jsx("iframe",{className:s.sunoIframe,src:$(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("button",{className:s.sunoBtn,onClick:Y,title:"음원 버전을 재생합니다",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),"음원 듣기"]})}),M&&u&&e.jsxs("div",{className:s.playlistNav,children:[e.jsx("button",{className:s.navBtn,onClick:f,disabled:!m,"aria-label":"이전 곡",title:"이전 곡으로 이동합니다",children:"⏮"}),e.jsxs("span",{className:s.navPosition,children:[d+1," / ",u.length]}),e.jsx("button",{className:s.navBtn,onClick:_,disabled:!o,"aria-label":"다음 곡",title:"다음 곡으로 이동합니다",children:"⏭"})]}),e.jsxs("div",{className:s.info,children:[e.jsx("h3",{className:s.title,children:t.title}),e.jsxs("div",{className:s.statsRow,children:[e.jsxs("div",{className:s.counts,children:[e.jsxs("span",{className:s.countItem,children:["▶ ",t.view_count??0]}),n>0&&e.jsxs("span",{className:s.countItem,children:["♥ ",n]}),j>0&&e.jsxs("span",{className:s.countItem,children:["★ ",j]})]}),e.jsxs("div",{className:s.actions,children:[e.jsx(je,{songId:t.id}),e.jsx(Z,{targetType:"song",targetId:t.id}),e.jsx(ee,{title:t.title,text:t.description||t.title})]})]}),t.description&&e.jsx("p",{className:s.description,children:t.description}),D&&e.jsx("div",{className:s.tags,children:t.tags.map(h=>e.jsxs("span",{className:s.tag,children:["#",h]},h))}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.lyricsActions,children:[e.jsx("button",{className:s.lyricsToggle,onClick:()=>T(h=>!h),title:"가사를 펼치거나 접습니다",children:S?"가사 접기 ▲":"가사 보기 ▼"}),e.jsx("button",{className:s.lyricsPlayerBtn,onClick:K,title:"전체 화면으로 가사를 보면서 들을 수 있습니다",children:"가사 플레이어"})]}),S&&e.jsx("div",{className:s.lyrics,children:ke(t.lyrics)})]})]})]})}export{je as A,st as S,ke as c,ne as u};
