import{r as a,f as V,w as K,a as z,j as e,o as U,m as G,t as Y}from"./index-CUPqXICw.js";import{u as J,a as Q,L as X,S as Z}from"./LikeButton-BoVZRxf8.js";let L=!1,E=!1;const I=[];function ee(){return E&&window.YT?Promise.resolve():new Promise(t=>{if(I.push(t),L)return;L=!0;const c=window.onYouTubeIframeAPIReady;if(window.onYouTubeIframeAPIReady=()=>{E=!0,L=!1,c==null||c(),I.forEach(i=>i()),I.length=0},document.querySelector('script[src*="youtube.com/iframe_api"]')){window.YT&&window.YT.Player&&(E=!0,L=!1,I.forEach(i=>i()),I.length=0);return}const r=document.createElement("script");r.src="https://www.youtube.com/iframe_api",r.async=!0,document.head.appendChild(r)})}function te({containerId:t,videoId:c,autoplay:r,enabled:i,onEnd:k,onPlay:N}){const u=a.useRef(null),d=a.useRef(k),o=a.useRef(N);d.current=k,o.current=N;const m=a.useCallback(()=>{var _;try{(_=u.current)==null||_.destroy()}catch{}u.current=null},[]);return a.useEffect(()=>{if(!i||!c){m();return}let _=!1;return ee().then(()=>{_||!window.YT||(m(),!document.getElementById(t))||(u.current=new window.YT.Player(t,{videoId:c,playerVars:{autoplay:r?1:0,rel:0,modestbranding:1,playsinline:1,enablejsapi:1},events:{onStateChange:y=>{var x,b;y.data===0&&((x=d.current)==null||x.call(d)),y.data===1&&((b=o.current)==null||b.call(o))}}}))}),()=>{_=!0,m()}},[i,c,t,r,m]),{destroyPlayer:m}}const se="_wrapper_mq9yh_1",ne="_favBtn_mq9yh_17",ae="_star_mq9yh_55",ie="_favActive_mq9yh_85",le="_moreBtn_mq9yh_107",ce="_dropdown_mq9yh_149",re="_dropdownHeader_mq9yh_175",oe="_empty_mq9yh_195",ue="_dropdownItem_mq9yh_207",de="_included_mq9yh_245",me="_itemCheck_mq9yh_253",_e="_itemName_mq9yh_265",ye="_itemCount_mq9yh_279",pe="_createBtn_mq9yh_291",he="_createForm_mq9yh_329",fe="_createInput_mq9yh_343",we="_createConfirm_mq9yh_375",l={wrapper:se,favBtn:ne,star:ae,favActive:ie,moreBtn:le,dropdown:ce,dropdownHeader:re,empty:oe,dropdownItem:ue,included:de,itemCheck:me,itemName:_e,itemCount:ye,createBtn:pe,createForm:he,createInput:fe,createConfirm:we},$="즐겨찾기";function xe({songId:t}){const{isLoggedIn:c,user:r}=V(),{playlists:i,createPlaylist:k,addSongToPlaylist:N,removeSongFromPlaylist:u}=K(),d=z(),[o,m]=a.useState(!1),[_,w]=a.useState(!1),[y,x]=a.useState(""),[b,P]=a.useState(!1),g=a.useRef(null),v=i.find(n=>n.name===$),p=v?v.song_ids.includes(t):!1;a.useEffect(()=>{if(!o)return;const n=h=>{g.current&&!g.current.contains(h.target)&&(m(!1),w(!1))};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[o]);const S=async n=>{if(n.stopPropagation(),!c){d("/login");return}if(!b){P(!0);try{v?p?await u(v.id,t):await N(v.id,t):await k({user_id:r.id,name:$,song_ids:[t]})}finally{P(!1)}}},T=n=>{if(n.stopPropagation(),!c){d("/login");return}m(!o),w(!1)},q=async n=>{await N(n,t)},C=async n=>{await u(n,t)},j=async()=>{!y.trim()||!r||(await k({user_id:r.id,name:y.trim(),song_ids:[t]}),x(""),w(!1))},B=n=>{n.key==="Enter"&&j(),n.key==="Escape"&&w(!1)};return e.jsxs("div",{className:l.wrapper,ref:g,children:[e.jsxs("button",{className:`${l.favBtn} ${p?l.favActive:""}`,onClick:S,disabled:b,"aria-label":p?"즐겨찾기에서 제거":"즐겨찾기에 추가",title:p?"즐겨찾기에서 이 곡을 제거합니다":"이 곡을 즐겨찾기에 추가합니다",children:[e.jsx("span",{className:l.star,children:p?"★":"☆"}),"즐겨찾기"]}),e.jsx("button",{className:l.moreBtn,onClick:T,"aria-label":"다른 재생목록에 추가",title:"다른 재생목록을 선택하여 곡을 추가합니다",children:"▾"}),o&&e.jsxs("div",{className:l.dropdown,children:[e.jsx("div",{className:l.dropdownHeader,children:"재생목록에 추가"}),i.length===0&&!_&&e.jsx("div",{className:l.empty,children:"재생목록이 없습니다"}),i.map(n=>{const h=n.song_ids.includes(t);return e.jsxs("button",{className:`${l.dropdownItem} ${h?l.included:""}`,onClick:()=>h?C(n.id):q(n.id),children:[e.jsx("span",{className:l.itemCheck,children:h?"✓":""}),e.jsx("span",{className:l.itemName,children:n.name}),e.jsxs("span",{className:l.itemCount,children:[n.song_ids.length,"곡"]})]},n.id)}),_?e.jsxs("div",{className:l.createForm,children:[e.jsx("input",{className:l.createInput,type:"text",value:y,onChange:n=>x(n.target.value),onKeyDown:B,placeholder:"재생목록 이름",autoFocus:!0,maxLength:50}),e.jsx("button",{className:l.createConfirm,onClick:j,disabled:!y.trim(),children:"확인"})]}):e.jsx("button",{className:l.createBtn,onClick:()=>w(!0),children:"+ 새 재생목록 만들기"})]})]})}function ve(t){return t.split(`
`).filter(c=>!/^\s*\[.*\]\s*$/.test(c)).join(`
`).replace(/\n{3,}/g,`

`).trim()}const je="_card_pwkl9_1",ke="_thumbnail_pwkl9_13",Ne="_thumbnailImg_pwkl9_22",be="_playBtn_pwkl9_33",ge="_sourceBadge_pwkl9_64",Ce="_ytContainer_pwkl9_84",Pe="_sunoPlaceholder_pwkl9_90",Be="_sunoLabel_pwkl9_109",Ie="_sunoPlayIcon_pwkl9_115",Se="_sunoIframe_pwkl9_146",qe="_sunoSection_pwkl9_154",Le="_sunoBtn_pwkl9_164",Te="_playlistNav_pwkl9_185",Ae="_navBtn_pwkl9_195",Ee="_navPosition_pwkl9_215",Re="_info_pwkl9_223",Fe="_statsRow_pwkl9_227",Ye="_counts_pwkl9_236",$e="_countItem_pwkl9_242",Ve="_actions_pwkl9_256",Oe="_title_pwkl9_262",He="_description_pwkl9_270",De="_tags_pwkl9_281",Me="_tag_pwkl9_281",We="_lyricsActions_pwkl9_297",Ke="_lyricsToggle_pwkl9_305",ze="_lyricsPlayerBtn_pwkl9_322",Ue="_lyrics_pwkl9_297",s={card:je,thumbnail:ke,thumbnailImg:Ne,playBtn:be,sourceBadge:ge,ytContainer:Ce,sunoPlaceholder:Pe,sunoLabel:Be,sunoPlayIcon:Ie,sunoIframe:Se,sunoSection:qe,sunoBtn:Le,playlistNav:Te,navBtn:Ae,navPosition:Ee,info:Re,statsRow:Fe,counts:Ye,countItem:$e,actions:Ve,title:Oe,description:He,tags:De,tag:Me,lyricsActions:We,lyricsToggle:Ke,lyricsPlayerBtn:ze,lyrics:Ue};function Ze({song:t,index:c=0,contextPlaylist:r}){const{currentId:i,play:k,onSongEnd:N,playlist:u,currentIndex:d,hasNext:o,hasPrev:m,next:_,prev:w,setPlaylist:y,autoPlayIntent:x,openLyricsPlayer:b}=U(),[P,g]=a.useState(!1),[v,p]=a.useState(!1),[S,T]=a.useState(!1),q=a.useRef(null),C=!!t.youtube_id,j=!!t.suno_url,{user:B}=V(),{count:n}=J("song",t.id,B==null?void 0:B.id),h=Q(t.id),O=!!t.lyrics,H=t.tags&&t.tags.length>0,D=u!==null&&i===t.id&&d>=0,R=`yt-${a.useId().replace(/:/g,"")}`;a.useEffect(()=>{i&&i!==t.id&&(g(!1),p(!1))},[i,t.id]),a.useEffect(()=>{i===t.id&&x&&(C?g(!0):j&&p(!0),requestAnimationFrame(()=>{var f;(f=q.current)==null||f.scrollIntoView({behavior:"smooth",block:"center"})}))},[i,t.id,x,C,j]),te({containerId:R,videoId:t.youtube_id||null,autoplay:!0,enabled:P&&C,onEnd:()=>{N()}});const A=f=>{r&&r.length>0&&y(r),k(f)},M=()=>{A(t.id),g(!0)},F=()=>{A(t.id),p(!0)},W=()=>{A(t.id),b()};return e.jsxs(G.article,{ref:q,className:s.card,initial:{opacity:0,y:30},whileInView:{opacity:1,y:0},viewport:{once:!0,margin:"-40px"},transition:{duration:.5,delay:c*.1},children:[e.jsx("div",{className:s.thumbnail,children:C?P?e.jsx("div",{id:R,className:s.ytContainer}):e.jsxs(e.Fragment,{children:[e.jsx("img",{className:s.thumbnailImg,src:`https://img.youtube.com/vi/${t.youtube_id}/hqdefault.jpg`,alt:t.title,loading:"lazy"}),e.jsx("button",{className:s.playBtn,onClick:M,"aria-label":`${t.title} 재생`,title:"클릭하면 노래가 재생됩니다"}),j&&e.jsx("span",{className:s.sourceBadge,children:"YouTube"})]}):j?v?e.jsx("iframe",{className:s.sunoIframe,src:Y(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("div",{className:s.sunoPlaceholder,onClick:F,title:"클릭하면 노래가 재생됩니다",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),e.jsx("span",{className:s.sunoLabel,children:"음원 재생"}),e.jsx("div",{className:s.sunoPlayIcon})]}):null}),C&&j&&e.jsx("div",{className:s.sunoSection,children:v?e.jsx("iframe",{className:s.sunoIframe,src:Y(t.suno_url),title:t.title,allow:"autoplay",frameBorder:"0"}):e.jsxs("button",{className:s.sunoBtn,onClick:F,title:"음원 버전을 재생합니다",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M9 18V5l12-2v13",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("circle",{cx:"6",cy:"18",r:"3"}),e.jsx("circle",{cx:"18",cy:"16",r:"3"})]}),"음원 듣기"]})}),D&&u&&e.jsxs("div",{className:s.playlistNav,children:[e.jsx("button",{className:s.navBtn,onClick:w,disabled:!m,"aria-label":"이전 곡",title:"이전 곡으로 이동합니다",children:"⏮"}),e.jsxs("span",{className:s.navPosition,children:[d+1," / ",u.length]}),e.jsx("button",{className:s.navBtn,onClick:_,disabled:!o,"aria-label":"다음 곡",title:"다음 곡으로 이동합니다",children:"⏭"})]}),e.jsxs("div",{className:s.info,children:[e.jsx("h3",{className:s.title,children:t.title}),e.jsxs("div",{className:s.statsRow,children:[(n>0||h>0)&&e.jsxs("div",{className:s.counts,children:[n>0&&e.jsxs("span",{className:s.countItem,children:["♥ ",n]}),h>0&&e.jsxs("span",{className:s.countItem,children:["★ ",h]})]}),e.jsxs("div",{className:s.actions,children:[e.jsx(xe,{songId:t.id}),e.jsx(X,{targetType:"song",targetId:t.id}),e.jsx(Z,{title:t.title,text:t.description||t.title})]})]}),t.description&&e.jsx("p",{className:s.description,children:t.description}),H&&e.jsx("div",{className:s.tags,children:t.tags.map(f=>e.jsxs("span",{className:s.tag,children:["#",f]},f))}),O&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.lyricsActions,children:[e.jsx("button",{className:s.lyricsToggle,onClick:()=>T(f=>!f),title:"가사를 펼치거나 접습니다",children:S?"가사 접기 ▲":"가사 보기 ▼"}),e.jsx("button",{className:s.lyricsPlayerBtn,onClick:W,title:"전체 화면으로 가사를 보면서 들을 수 있습니다",children:"가사 플레이어"})]}),S&&e.jsx("div",{className:s.lyrics,children:ve(t.lyrics)})]})]})]})}export{xe as A,Ze as S,ve as c,te as u};
