import{r as c,j as t,s as h,f as y,a as p}from"./index-CNhTrOr2.js";const b="_btn_7bqaf_1",j="_copied_7bqaf_47",x={btn:b,copied:j};function E({title:e,text:s,url:o}){const[r,n]=c.useState(!1),i=o||window.location.href,l=c.useCallback(async()=>{if(navigator.share)try{await navigator.share({title:e,text:s||e,url:i});return}catch{return}try{await navigator.clipboard.writeText(i),n(!0),setTimeout(()=>n(!1),2e3)}catch{const a=document.createElement("textarea");a.value=i,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),n(!0),setTimeout(()=>n(!1),2e3)}},[e,s,i]);return t.jsx("button",{className:`${x.btn} ${r?x.copied:""}`,onClick:l,title:"공유하기",children:r?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})}),"복사됨"]}):t.jsxs(t.Fragment,{children:[t.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("circle",{cx:"18",cy:"5",r:"3"}),t.jsx("circle",{cx:"6",cy:"12",r:"3"}),t.jsx("circle",{cx:"18",cy:"19",r:"3"}),t.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),t.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]}),"공유"]})})}const g="즐겨찾기";function N(e){const[s,o]=c.useState(0);return c.useEffect(()=>{if(!e)return;(async()=>{const{data:n}=await h.from("hohai_playlists").select("id").eq("name",g).contains("song_ids",[e]);o((n==null?void 0:n.length)||0)})()},[e]),s}function C(e,s,o){const[r,n]=c.useState(0),[i,l]=c.useState(!1),[a,f]=c.useState(!0),_=c.useCallback(async()=>{if(!s)return;const{count:u}=await h.from("hohai_likes").select("*",{count:"exact",head:!0}).eq("target_type",e).eq("target_id",s);if(n(u||0),o){const{data:m}=await h.from("hohai_likes").select("id").eq("target_type",e).eq("target_id",s).eq("user_id",o).maybeSingle();l(!!m)}f(!1)},[e,s,o]);c.useEffect(()=>{_()},[_]);const k=c.useCallback(async()=>{!o||!s||(i?(await h.from("hohai_likes").delete().eq("user_id",o).eq("target_type",e).eq("target_id",s),l(!1),n(u=>Math.max(0,u-1))):(await h.from("hohai_likes").insert({user_id:o,target_type:e,target_id:s}),l(!0),n(u=>u+1)))},[i,o,e,s]);return{count:r,liked:i,loading:a,toggle:k}}const w="_btn_1yr59_1",v="_liked_1yr59_47",q="_heart_1yr59_59",L="_count_1yr59_79",d={btn:w,liked:v,heart:q,count:L};function $({targetType:e,targetId:s}){const{isLoggedIn:o,user:r}=y(),n=p(),{count:i,liked:l,toggle:a}=C(e,s,r==null?void 0:r.id),f=()=>{if(!o){n("/login");return}a()};return t.jsxs("button",{className:`${d.btn} ${l?d.liked:""}`,onClick:f,title:l?"좋아요 취소":"좋아요",children:[t.jsx("span",{className:d.heart,children:l?"♥":"♡"}),"좋아요",i>0&&t.jsx("span",{className:d.count,children:i})]})}export{$ as L,E as S,N as a,C as u};
